<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>내 에이전트 - GrowFit</title>
    <style>
/* ========== CSS Variables ========== */
:root {
    --primary-50: #faf5ff;
    --primary-100: #f3e8ff;
    --primary-200: #e9d5ff;
    --primary-300: #d8b4fe;
    --primary-400: #c084fc;
    --primary-500: #a855f7;
    --primary-600: #9333ea;
    --primary-700: #7e22ce;
    --primary-800: #6b21a8;
    --primary-900: #581c87;

    --gray-50: #f8fafc;
    --gray-100: #f1f5f9;
    --gray-200: #e2e8f0;
    --gray-300: #cbd5e1;
    --gray-400: #94a3b8;
    --gray-500: #64748b;
    --gray-600: #475569;
    --gray-700: #334155;
    --gray-800: #1e293b;
    --gray-900: #0f172a;

    --success: #10b981;
    --success-light: #d1fae5;
    --warning: #f59e0b;
    --warning-light: #fef3c7;
    --error: #ef4444;
    --error-light: #fee2e2;
    --info: #3b82f6;
    --info-light: #dbeafe;

    --background: #ffffff;
    --surface: #f8fafc;
    --border: #e2e8f0;
    --text-primary: #0f172a;
    --text-secondary: #475569;
    --text-tertiary: #94a3b8;

    --sidebar-width: 260px;
    --header-height: 56px;
    --font-sans: -apple-system, BlinkMacSystemFont, "Pretendard", "Segoe UI", sans-serif;
    --radius-sm: 4px;
    --radius-md: 8px;
    --radius-lg: 12px;
    --radius-xl: 16px;
    --radius-full: 9999px;
    --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
    --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
    --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
}

* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: var(--font-sans); background: var(--background); color: var(--text-primary); height: 100vh; overflow: hidden; }

.icon { width: 20px; height: 20px; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; fill: none; flex-shrink: 0; }
.icon--sm { width: 16px; height: 16px; }
.icon--lg { width: 24px; height: 24px; }

.app { display: flex; height: 100vh; }

/* ========== Sidebar ========== */
.sidebar { width: var(--sidebar-width); background: var(--background); border-right: 1px solid var(--border); display: flex; flex-direction: column; flex-shrink: 0; }
.sidebar__header { padding: 16px; border-bottom: 1px solid var(--border); }
.sidebar__logo { display: flex; align-items: center; gap: 10px; margin-bottom: 16px; }
.sidebar__logo-icon { width: 32px; height: 32px; background: linear-gradient(135deg, var(--primary-500), var(--primary-700)); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; color: white; }
.sidebar__logo-text { font-size: 14px; font-weight: 700; color: var(--text-primary); }
.sidebar__logo-badge { background: var(--primary-600); color: white; font-size: 10px; font-weight: 600; padding: 2px 6px; border-radius: var(--radius-sm); }

.sidebar__new-chat { display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%; padding: 10px; border: 1px dashed var(--border); border-radius: var(--radius-md); background: transparent; font-size: 13px; font-weight: 500; color: var(--text-secondary); cursor: pointer; transition: all 0.2s; }
.sidebar__new-chat:hover { background: var(--surface); border-color: var(--primary-300); color: var(--primary-600); }

/* Class Selector */
.class-selector { margin-bottom: 16px; position: relative; }
.class-selector__button { width: 100%; display: flex; align-items: center; gap: 10px; padding: 10px 12px; background: linear-gradient(135deg, var(--primary-50), var(--primary-100)); border: 1px solid var(--primary-200); border-radius: var(--radius-md); cursor: pointer; transition: all 0.2s; text-align: left; }
.class-selector__button:hover { border-color: var(--primary-300); background: linear-gradient(135deg, var(--primary-100), var(--primary-200)); }
.class-selector__icon { width: 36px; height: 36px; background: var(--primary-600); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; color: white; }
.class-selector__info { flex: 1; min-width: 0; }
.class-selector__name { font-size: 13px; font-weight: 600; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.class-selector__meta { display: flex; align-items: center; gap: 8px; margin-top: 3px; }
.class-selector__status { display: inline-flex; align-items: center; gap: 4px; font-size: 11px; font-weight: 500; }
.class-selector__status--active { color: var(--success); }
.class-selector__status-dot { width: 6px; height: 6px; border-radius: var(--radius-full); background: currentColor; }
.class-selector__dday { font-size: 11px; font-weight: 600; color: var(--primary-600); background: var(--primary-100); padding: 2px 6px; border-radius: var(--radius-sm); }
.class-selector__arrow { color: var(--text-tertiary); transition: transform 0.2s; }
.class-selector__button.open .class-selector__arrow { transform: rotate(180deg); }

.class-dropdown { position: absolute; top: calc(100% + 4px); left: 0; right: 0; background: var(--background); border: 1px solid var(--border); border-radius: var(--radius-lg); box-shadow: var(--shadow-lg); z-index: 1000; opacity: 0; visibility: hidden; transform: translateY(-8px); transition: all 0.2s; max-height: 300px; overflow-y: auto; }
.class-dropdown--open { opacity: 1; visibility: visible; transform: translateY(0); }
.class-dropdown__section { padding: 8px; }
.class-dropdown__section-title { font-size: 10px; font-weight: 600; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.5px; padding: 8px 10px 6px; }
.class-dropdown__item { display: flex; align-items: center; gap: 10px; padding: 10px; border-radius: var(--radius-md); cursor: pointer; transition: background 0.2s; }
.class-dropdown__item:hover { background: var(--surface); }
.class-dropdown__item--active { background: var(--primary-50); }
.class-dropdown__item--disabled { opacity: 0.5; cursor: not-allowed; }
.class-dropdown__item-icon { width: 32px; height: 32px; border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
.class-dropdown__item-icon--active { background: var(--primary-100); color: var(--primary-600); }
.class-dropdown__item-icon--ended { background: var(--gray-100); color: var(--gray-400); }
.class-dropdown__item-info { flex: 1; min-width: 0; }
.class-dropdown__item-name { font-size: 13px; font-weight: 500; color: var(--text-primary); }
.class-dropdown__item-period { font-size: 11px; color: var(--text-tertiary); margin-top: 2px; }
.class-dropdown__item-badge { font-size: 10px; font-weight: 600; padding: 2px 8px; border-radius: var(--radius-full); }
.class-dropdown__item-badge--active { background: var(--success); color: white; }
.class-dropdown__item-badge--ended { background: var(--gray-200); color: var(--text-tertiary); }
.class-dropdown__divider { height: 1px; background: var(--border); margin: 4px 8px; }
.class-selector__status--ended { color: var(--text-tertiary); }

.sidebar__nav { padding: 8px 12px; border-bottom: 1px solid var(--border); }
.sidebar__nav-item { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-radius: var(--radius-md); color: var(--text-secondary); text-decoration: none; font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.2s; margin-bottom: 2px; }
.sidebar__nav-item:hover { background: var(--surface); color: var(--text-primary); }
.sidebar__nav-item--active { background: var(--primary-50); color: var(--primary-600); }
.sidebar__nav-icon { width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; }

.sidebar__section-header { display: flex; align-items: center; justify-content: space-between; padding: 16px 16px 8px; }
.sidebar__section-title { font-size: 11px; font-weight: 600; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.5px; }
.sidebar__section-search { width: 24px; height: 24px; border: none; background: transparent; border-radius: var(--radius-sm); cursor: pointer; color: var(--text-tertiary); display: flex; align-items: center; justify-content: center; }
.sidebar__section-search:hover { background: var(--surface); color: var(--text-primary); }
.sidebar__history { flex: 1; overflow-y: auto; padding: 0 8px; }

.chat-item { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-radius: var(--radius-md); cursor: pointer; transition: all 0.2s; margin-bottom: 2px; position: relative; }
.chat-item:hover { background: var(--surface); }
.chat-item--active { background: var(--primary-50); }
.chat-item__pin-dot { width: 6px; height: 6px; border-radius: var(--radius-full); background: var(--warning); flex-shrink: 0; }
.chat-item__icon { width: 32px; height: 32px; border-radius: var(--radius-md); background: var(--gray-100); display: flex; align-items: center; justify-content: center; color: var(--text-tertiary); flex-shrink: 0; }
.chat-item--active .chat-item__icon { background: var(--primary-100); color: var(--primary-600); }
.chat-item__info { flex: 1; min-width: 0; }
.chat-item__title { font-size: 13px; font-weight: 500; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.chat-item__meta { display: flex; align-items: center; gap: 6px; margin-top: 2px; }
.chat-item__time { font-size: 11px; color: var(--text-tertiary); }
.chat-item__project-badge { display: inline-flex; align-items: center; gap: 3px; font-size: 10px; font-weight: 500; padding: 1px 6px; border-radius: var(--radius-sm); background: var(--primary-100); color: var(--primary-600); max-width: 80px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.chat-item__project-badge svg { width: 10px; height: 10px; flex-shrink: 0; }
.chat-item__menu { width: 24px; height: 24px; border: none; background: transparent; border-radius: var(--radius-sm); cursor: pointer; color: var(--text-tertiary); opacity: 0; transition: all 0.2s; display: flex; align-items: center; justify-content: center; }
.chat-item:hover .chat-item__menu { opacity: 1; }
.chat-item__menu:hover { background: var(--gray-200); color: var(--text-primary); }

/* Context Menu */
.context-menu { position: fixed; min-width: 180px; background: var(--background); border: 1px solid var(--border); border-radius: var(--radius-lg); box-shadow: var(--shadow-lg); z-index: 9999; padding: 4px; opacity: 0; visibility: hidden; }
.context-menu--open { opacity: 1; visibility: visible; }
.context-menu__item { display: flex; align-items: center; gap: 8px; padding: 8px 12px; font-size: 13px; color: var(--text-primary); cursor: pointer; border-radius: var(--radius-md); transition: background 0.2s; }
.context-menu__item:hover { background: var(--surface); }
.context-menu__item--danger { color: var(--error); }
.context-menu__item--danger:hover { background: #fef2f2; }
.context-menu__item--project-add { color: var(--success); }
.context-menu__item--project-add:hover { background: #ecfdf5; }
.context-menu__item--project-change { color: var(--info); }
.context-menu__item--project-change:hover { background: #eff6ff; }
.context-menu__item--project-remove { color: var(--warning); }
.context-menu__item--project-remove:hover { background: #fffbeb; }
.context-menu__divider { height: 1px; background: var(--border); margin: 4px 0; }

.sidebar__footer { border-top: 1px solid var(--border); padding: 8px; }
.sidebar__footer-item { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-radius: var(--radius-md); cursor: pointer; transition: all 0.2s; color: var(--text-secondary); font-size: 13px; }
.sidebar__footer-item:hover { background: var(--surface); color: var(--text-primary); }
.sidebar__user { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-radius: var(--radius-md); cursor: pointer; transition: all 0.2s; }
.sidebar__user:hover { background: var(--surface); }
.sidebar__user-avatar { width: 32px; height: 32px; border-radius: var(--radius-full); background: linear-gradient(135deg, var(--primary-400), var(--primary-600)); color: white; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 600; }
.sidebar__user-name { flex: 1; font-size: 13px; font-weight: 500; color: var(--text-primary); }
.sidebar__logout { color: var(--text-tertiary); }

/* ========== Main ========== */
.main { flex: 1; display: flex; flex-direction: column; min-width: 0; background: var(--surface); }

.page-header { display: flex; align-items: center; justify-content: space-between; padding: 16px 24px; background: var(--background); border-bottom: 1px solid var(--border); }
.page-header__left { display: flex; align-items: center; gap: 12px; }
.page-header__title { font-size: 18px; font-weight: 700; color: var(--text-primary); }
.page-header__right { display: flex; align-items: center; gap: 8px; }

.btn { display: inline-flex; align-items: center; justify-content: center; gap: 6px; padding: 8px 16px; border-radius: var(--radius-md); font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.2s; border: none; }
.btn--primary { background: var(--primary-600); color: white; }
.btn--primary:hover { background: var(--primary-700); }
.btn--outline { background: var(--background); border: 1px solid var(--border); color: var(--text-primary); }
.btn--outline:hover { background: var(--surface); border-color: var(--primary-300); }
.btn--sm { padding: 6px 12px; font-size: 12px; }

/* ========== Agent Content ========== */
.agent-content { flex: 1; overflow-y: auto; padding: 24px; }

/* Tabs */
.agent-tabs-wrapper { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; }
.agent-tabs { display: flex; gap: 4px; background: var(--background); padding: 4px; border-radius: var(--radius-lg); border: 1px solid var(--border); }
.agent-tab { padding: 10px 20px; border: none; background: transparent; border-radius: var(--radius-md); font-size: 13px; font-weight: 500; color: var(--text-secondary); cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 8px; }
.agent-tab:hover { background: var(--surface); color: var(--text-primary); }
.agent-tab--active { background: var(--primary-600); color: white; }
.agent-tab__count { padding: 2px 8px; border-radius: var(--radius-full); font-size: 11px; font-weight: 600; }
.agent-tab--active .agent-tab__count { background: rgba(255,255,255,0.2); color: white; }
.agent-tab:not(.agent-tab--active) .agent-tab__count { background: var(--gray-200); color: var(--text-secondary); }

/* Stats Bar */
.stats-bar { display: flex; align-items: center; gap: 24px; padding: 16px 20px; background: linear-gradient(135deg, var(--primary-50), var(--surface)); border: 1px solid var(--primary-100); border-radius: var(--radius-lg); margin-bottom: 24px; }
.stats-bar__item { display: flex; align-items: center; gap: 10px; }
.stats-bar__icon { width: 36px; height: 36px; border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; }
.stats-bar__icon--total { background: var(--primary-100); color: var(--primary-600); }
.stats-bar__icon--active { background: var(--success-light); color: var(--success); }
.stats-bar__icon--usage { background: var(--info-light); color: var(--info); }
.stats-bar__info { display: flex; flex-direction: column; }
.stats-bar__value { font-size: 18px; font-weight: 700; color: var(--text-primary); }
.stats-bar__label { font-size: 12px; color: var(--text-secondary); }

/* Search & Filter */
.toolbar { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; }
.search-box { flex: 1; max-width: 280px; position: relative; }
.search-box__input { width: 100%; padding: 10px 14px 10px 40px; border: 1px solid var(--border); border-radius: var(--radius-md); font-size: 13px; background: var(--background); transition: all 0.2s; }
.search-box__input:focus { outline: none; border-color: var(--primary-400); box-shadow: 0 0 0 3px var(--primary-100); }
.search-box__input::placeholder { color: var(--text-tertiary); }
.search-box__icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--text-tertiary); }

/* Filter Dropdown */
.filter-dropdown { position: relative; }
.filter-dropdown__btn { display: flex; align-items: center; gap: 8px; padding: 10px 14px; border: 1px solid var(--border); border-radius: var(--radius-md); background: var(--background); font-size: 13px; color: var(--text-primary); cursor: pointer; transition: all 0.2s; white-space: nowrap; }
.filter-dropdown__btn:hover { border-color: var(--primary-300); background: var(--surface); }
.filter-dropdown__btn.active { border-color: var(--primary-500); background: var(--primary-50); }
.filter-dropdown__menu { position: absolute; top: calc(100% + 4px); left: 0; min-width: 160px; background: var(--background); border: 1px solid var(--border); border-radius: var(--radius-md); box-shadow: var(--shadow-lg); z-index: 100; opacity: 0; visibility: hidden; transform: translateY(-4px); transition: all 0.2s; }
.filter-dropdown__menu.show { opacity: 1; visibility: visible; transform: translateY(0); }
.filter-dropdown__item { display: flex; align-items: center; gap: 8px; padding: 10px 14px; font-size: 13px; color: var(--text-secondary); cursor: pointer; transition: all 0.2s; }
.filter-dropdown__item:first-child { border-radius: var(--radius-md) var(--radius-md) 0 0; }
.filter-dropdown__item:last-child { border-radius: 0 0 var(--radius-md) var(--radius-md); }
.filter-dropdown__item:hover { background: var(--surface); color: var(--text-primary); }
.filter-dropdown__item.selected { background: var(--primary-50); color: var(--primary-600); font-weight: 500; }
.filter-dropdown__item svg { opacity: 0; width: 16px; height: 16px; }
.filter-dropdown__item.selected svg { opacity: 1; color: var(--primary-600); }

/* Pagination */
.pagination { display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 32px; padding-top: 24px; border-top: 1px solid var(--border); }
.pagination__btn { display: flex; align-items: center; gap: 6px; padding: 8px 14px; border: 1px solid var(--border); border-radius: var(--radius-md); background: var(--background); font-size: 13px; color: var(--text-secondary); cursor: pointer; transition: all 0.2s; }
.pagination__btn:hover:not(:disabled) { border-color: var(--primary-300); color: var(--text-primary); background: var(--surface); }
.pagination__btn:disabled { opacity: 0.5; cursor: not-allowed; }
.pagination__pages { display: flex; gap: 4px; }
.pagination__page { width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border: 1px solid var(--border); border-radius: var(--radius-md); background: var(--background); font-size: 13px; color: var(--text-secondary); cursor: pointer; transition: all 0.2s; }
.pagination__page:hover { border-color: var(--primary-300); color: var(--text-primary); }
.pagination__page--active { background: var(--primary-600); border-color: var(--primary-600); color: white; }

/* Agent Grid */
.agent-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 16px; }

/* Section Header */
.section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
.section-header__title { display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 600; color: var(--text-primary); }
.section-header__title svg { color: var(--text-tertiary); }
.section-header__count { font-size: 12px; color: var(--text-tertiary); }

/* Template Section Container - 섹션 분리를 위한 스타일 */
.template-section { background: var(--background); border: 1px solid var(--border); border-radius: var(--radius-xl); padding: 24px; margin-bottom: 24px; }
.template-section .section-header { margin-bottom: 20px; padding-bottom: 16px; border-bottom: 1px solid var(--border); }
.template-section .section-header__title { font-size: 15px; }
.template-section .section-header__title svg { color: var(--primary-500); }

/* 강사 공유 템플릿 섹션 차별화 - 아이콘 색상으로만 구분 */
.template-section--instructor .section-header__title svg { color: #f59e0b; }

/* Agent Card */
.agent-card { background: var(--background); border: 1px solid var(--border); border-radius: var(--radius-lg); padding: 20px; padding-left: 24px; transition: all 0.2s; cursor: pointer; position: relative; overflow: hidden; }
.agent-card::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px; background: var(--gray-300); }
.agent-card:hover { border-color: var(--primary-300); box-shadow: var(--shadow-md); }
.agent-card--template::before { background: var(--info); }

/* Card Colors */
.agent-card--purple::before { background: linear-gradient(180deg, #a855f7, #7c3aed); }
.agent-card--blue::before { background: linear-gradient(180deg, #3b82f6, #2563eb); }
.agent-card--teal::before { background: linear-gradient(180deg, #14b8a6, #0d9488); }
.agent-card--green::before { background: linear-gradient(180deg, #22c55e, #16a34a); }
.agent-card--orange::before { background: linear-gradient(180deg, #f97316, #ea580c); }
.agent-card--pink::before { background: linear-gradient(180deg, #ec4899, #db2777); }
.agent-card--red::before { background: linear-gradient(180deg, #ef4444, #dc2626); }
.agent-card--indigo::before { background: linear-gradient(180deg, #6366f1, #4f46e5); }

.agent-card__header { margin-bottom: 8px; }
.agent-card__name { font-size: 15px; font-weight: 600; color: var(--text-primary); margin-bottom: 6px; display: flex; align-items: center; gap: 8px; }
.agent-card__badge { font-size: 10px; font-weight: 600; padding: 2px 6px; border-radius: var(--radius-sm); }
.agent-card__badge--template { background: var(--info-light); color: var(--info); }
.agent-card__badge--instructor { background: var(--warning-light); color: #b45309; }
.agent-card__badge--active { background: var(--success-light); color: var(--success); }
.agent-card__badge--inactive { background: var(--gray-200); color: var(--text-tertiary); }
.agent-card__desc { font-size: 13px; color: var(--text-secondary); line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

.agent-card__meta { display: flex; align-items: center; gap: 16px; padding-top: 12px; border-top: 1px solid var(--border); margin-top: 12px; }
.agent-card__stat { display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-secondary); }
.agent-card__stat svg { width: 14px; height: 14px; }

.agent-card__actions { display: flex; gap: 8px; margin-top: 16px; }
.agent-card__btn { flex: 1; padding: 8px 12px; border-radius: var(--radius-md); font-size: 12px; font-weight: 500; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 6px; }
.agent-card__btn--primary { background: var(--primary-600); color: white; border: none; }
.agent-card__btn--primary:hover { background: var(--primary-700); }
.agent-card__btn--outline { background: transparent; border: 1px solid var(--border); color: var(--text-primary); }
.agent-card__btn--outline:hover { background: var(--surface); border-color: var(--primary-300); }
.agent-card__btn--danger { background: transparent; border: 1px solid var(--error); color: var(--error); }
.agent-card__btn--danger:hover { background: var(--error-light); }

/* Card Footer Hint (for templates) */
.agent-card__footer-hint { display: flex; align-items: center; justify-content: center; gap: 6px; margin-top: 16px; padding-top: 12px; border-top: 1px solid var(--border); font-size: 12px; color: var(--text-tertiary); }
.agent-card:hover .agent-card__footer-hint { color: var(--primary-600); }

/* Toggle Switch */
.agent-card__toggle { position: absolute; top: 16px; right: 16px; z-index: 1; }
.toggle-switch { position: relative; display: inline-block; width: 44px; height: 24px; }
.toggle-switch input { opacity: 0; width: 0; height: 0; }
.toggle-switch__slider { position: absolute; cursor: pointer; inset: 0; background: var(--gray-300); border-radius: var(--radius-full); transition: 0.3s; }
.toggle-switch__slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background: white; border-radius: var(--radius-full); transition: 0.3s; box-shadow: var(--shadow-sm); }
.toggle-switch input:checked + .toggle-switch__slider { background: var(--success); }
.toggle-switch input:checked + .toggle-switch__slider:before { transform: translateX(20px); }

/* Inactive Card State */
.agent-card--inactive { opacity: 0.7; }
.agent-card--inactive:hover { opacity: 1; }
.agent-card__badge--inactive { background: var(--gray-200); color: var(--text-tertiary); }

/* Empty State */
.empty-state { text-align: center; padding: 60px 20px; }
.empty-state__icon { width: 64px; height: 64px; border-radius: var(--radius-xl); background: var(--primary-100); color: var(--primary-600); display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; }
.empty-state__title { font-size: 16px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px; }
.empty-state__desc { font-size: 13px; color: var(--text-secondary); margin-bottom: 20px; }

/* ========== Modal ========== */
.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center; opacity: 0; visibility: hidden; transition: all 0.2s; }
.modal-overlay--open { opacity: 1; visibility: visible; }

.modal { background: var(--background); border-radius: var(--radius-xl); width: 100%; max-width: 600px; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column; transform: scale(0.95); transition: transform 0.2s; }
.modal-overlay--open .modal { transform: scale(1); }

.modal__header { display: flex; align-items: center; justify-content: space-between; padding: 20px 24px; border-bottom: 1px solid var(--border); }
.modal__title { font-size: 18px; font-weight: 600; color: var(--text-primary); }
.modal__close { width: 32px; height: 32px; border: none; background: transparent; border-radius: var(--radius-md); cursor: pointer; color: var(--text-tertiary); display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
.modal__close:hover { background: var(--surface); color: var(--text-primary); }

.modal__body { flex: 1; overflow-y: auto; padding: 24px; }
.modal__footer { display: flex; gap: 8px; padding: 16px 24px; border-top: 1px solid var(--border); background: var(--gray-50); }

.modal__btn { padding: 10px 20px; border-radius: var(--radius-md); font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.2s; border: 1px solid var(--border); background: var(--background); color: var(--text-primary); }
.modal__btn:hover { background: var(--surface); }
.modal__btn--primary { background: var(--primary-600); color: white; border-color: var(--primary-600); }
.modal__btn--primary:hover { background: var(--primary-700); border-color: var(--primary-700); }
.modal__btn--danger { background: var(--error); color: white; border-color: var(--error); }
.modal__btn--danger:hover { background: #dc2626; border-color: #dc2626; }

.modal--popup { max-width: 480px; }
.modal--popup .modal__header { display: none; }
.modal--popup .modal__body { padding: 0; }

/* ========== Enhanced Popup Styles ========== */
.popup-header { display: flex; align-items: center; gap: 12px; padding: 20px; border-bottom: 1px solid var(--border); }
.popup-header__icon { width: 40px; height: 40px; border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
.popup-header__icon--purple { background: var(--primary-100); color: var(--primary-600); }
.popup-header__icon--green { background: #ecfdf5; color: var(--success); }
.popup-header__icon--blue { background: #dbeafe; color: var(--info); }
.popup-header__text { flex: 1; }
.popup-header__title { font-size: 16px; font-weight: 600; color: var(--text-primary); }
.popup-header__subtitle { font-size: 12px; color: var(--text-tertiary); margin-top: 2px; }
.popup-close { width: 32px; height: 32px; border: none; background: transparent; border-radius: var(--radius-md); cursor: pointer; color: var(--text-tertiary); display: flex; align-items: center; justify-content: center; transition: all 0.15s ease; }
.popup-close:hover { background: var(--gray-100); color: var(--text-primary); }

.popup-search-bar { padding: 16px 20px; border-bottom: 1px solid var(--border); display: flex; gap: 12px; }
.popup-search { flex: 1; position: relative; }
.popup-search__icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-tertiary); pointer-events: none; }
.popup-search__input { width: 100%; padding: 10px 12px 10px 40px; border: 1px solid var(--border); border-radius: var(--radius-md); font-size: 13px; font-family: var(--font-sans); background: var(--background); transition: all 0.15s ease; }
.popup-search__input:focus { outline: none; border-color: var(--primary-400); box-shadow: 0 0 0 3px var(--primary-100); }
.popup-search__input::placeholder { color: var(--text-tertiary); }

.popup-list { max-height: 320px; overflow-y: auto; padding: 8px; }
.popup-list__empty { text-align: center; padding: 40px 20px; color: var(--text-tertiary); font-size: 13px; }

.popup-item { display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: var(--radius-md); cursor: pointer; transition: background 0.15s ease; border: 1px solid transparent; }
.popup-item:hover { background: var(--gray-50); }
.popup-item--selected { background: var(--primary-50); border-color: var(--primary-200); }
.popup-item--current { background: var(--gray-50); opacity: 0.6; cursor: default; }
.popup-item__color { width: 3px; height: 40px; border-radius: 2px; flex-shrink: 0; }
.popup-item__radio { width: 18px; height: 18px; border: 2px solid var(--border); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.15s ease; background: var(--background); }
.popup-item--selected .popup-item__radio { border-color: var(--primary-600); }
.popup-item__radio-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--primary-600); opacity: 0; transition: opacity 0.15s ease; }
.popup-item--selected .popup-item__radio-dot { opacity: 1; }
.popup-item__info { flex: 1; min-width: 0; }
.popup-item__name { font-size: 14px; font-weight: 500; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.popup-item__meta { display: flex; align-items: center; gap: 8px; margin-top: 4px; font-size: 12px; color: var(--text-tertiary); }
.popup-item__badge { font-size: 10px; font-weight: 500; padding: 2px 8px; border-radius: var(--radius-full); background: var(--gray-100); color: var(--text-secondary); }
.popup-item__badge--current { background: var(--primary-100); color: var(--primary-600); }

.popup-loadmore { padding: 12px; text-align: center; }
.popup-loadmore__btn { width: 100%; padding: 10px; border: 1px dashed var(--border); border-radius: var(--radius-md); background: transparent; font-size: 13px; font-weight: 500; color: var(--text-secondary); cursor: pointer; transition: all 0.15s ease; }
.popup-loadmore__btn:hover { background: var(--gray-50); border-color: var(--primary-300); color: var(--primary-600); }

.popup-footer { display: flex; justify-content: flex-end; gap: 8px; padding: 16px 20px; border-top: 1px solid var(--border); background: var(--gray-50); }
.popup-footer__btn { padding: 10px 20px; border: 1px solid var(--border); border-radius: var(--radius-md); font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.15s ease; background: var(--background); color: var(--text-primary); }
.popup-footer__btn:hover { background: var(--gray-100); }
.popup-footer__btn--primary { background: var(--primary-600); border-color: var(--primary-600); color: white; }
.popup-footer__btn--primary:hover { background: var(--primary-700); }
.popup-footer__btn--primary:disabled { background: var(--gray-300); border-color: var(--gray-300); cursor: not-allowed; }

.popup-current-banner { display: flex; align-items: center; gap: 8px; padding: 10px 20px; background: #fef3c7; border-bottom: 1px solid #fcd34d; font-size: 12px; color: #92400e; }
.popup-current-banner__icon { width: 16px; height: 16px; flex-shrink: 0; }

.form-group { margin-bottom: 20px; }
.form-label { display: block; font-size: 13px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px; }
.form-label__required { color: var(--error); margin-left: 2px; }
.form-input { width: 100%; padding: 10px 14px; border: 1px solid var(--border); border-radius: var(--radius-md); font-size: 13px; color: var(--text-primary); transition: all 0.2s; }
.form-input:focus { outline: none; border-color: var(--primary-400); box-shadow: 0 0 0 3px var(--primary-100); }
.form-input::placeholder { color: var(--text-tertiary); }
.form-textarea { min-height: 120px; resize: vertical; font-family: inherit; line-height: 1.6; }
.form-textarea--code { font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace; font-size: 12px; min-height: 200px; background: var(--gray-900); color: #e2e8f0; border-color: var(--gray-700); }
.form-textarea--code:focus { border-color: var(--primary-500); }
.form-hint { font-size: 12px; color: var(--text-tertiary); margin-top: 6px; }

/* Form Row */
.form-row { display: flex; gap: 16px; align-items: flex-start; }
.form-group--color { flex-shrink: 0; }
.form-group--name { flex: 1; }

/* Color Picker */
.color-picker { display: flex; gap: 8px; flex-wrap: wrap; }
.color-picker__item { width: 32px; height: 32px; border-radius: var(--radius-md); border: 2px solid transparent; cursor: pointer; transition: all 0.2s; }
.color-picker__item:hover { transform: scale(1.1); }
.color-picker__item--active { border-color: var(--text-primary); box-shadow: 0 0 0 2px white, 0 0 0 4px var(--text-primary); }

/* Guide Box */
.guide-box { background: var(--primary-50); border: 1px solid var(--primary-200); border-radius: var(--radius-md); padding: 16px; margin-bottom: 20px; }
.guide-box__title { font-size: 13px; font-weight: 600; color: var(--primary-700); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
.guide-box__list { display: flex; flex-direction: column; gap: 8px; }
.guide-box__item { display: flex; align-items: flex-start; gap: 8px; font-size: 12px; color: var(--text-secondary); line-height: 1.5; }
.guide-box__item-icon { color: var(--primary-500); flex-shrink: 0; margin-top: 2px; }

.modal__footer { display: flex; align-items: center; justify-content: flex-end; gap: 8px; padding: 16px 24px; border-top: 1px solid var(--border); background: var(--surface); }

/* Toast */
.toast { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); background: var(--gray-800); color: white; padding: 12px 20px; border-radius: var(--radius-md); font-size: 13px; z-index: 9999; animation: toast-in 0.3s ease; }
.toast--success { background: var(--success); }
.toast--error { background: var(--error); }
@keyframes toast-in { from { opacity: 0; transform: translateX(-50%) translateY(10px); } to { opacity: 1; transform: translateX(-50%) translateY(0); } }

/* Template Detail View */
.template-detail { display: none; }
.template-detail--active { display: block; }

.detail-back { display: flex; align-items: center; gap: 6px; font-size: 13px; color: var(--text-secondary); cursor: pointer; margin-bottom: 24px; padding: 8px 0; }
.detail-back:hover { color: var(--primary-600); }

.detail-card { background: var(--background); border: 1px solid var(--border); border-radius: var(--radius-xl); overflow: hidden; position: relative; padding-left: 6px; }
.detail-card::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 6px; background: var(--info); }
.detail-card--purple::before { background: linear-gradient(180deg, #a855f7, #7c3aed); }
.detail-card--blue::before { background: linear-gradient(180deg, #3b82f6, #2563eb); }
.detail-card--teal::before { background: linear-gradient(180deg, #14b8a6, #0d9488); }
.detail-card--green::before { background: linear-gradient(180deg, #22c55e, #16a34a); }
.detail-card--orange::before { background: linear-gradient(180deg, #f97316, #ea580c); }
.detail-card--pink::before { background: linear-gradient(180deg, #ec4899, #db2777); }
.detail-card--red::before { background: linear-gradient(180deg, #ef4444, #dc2626); }
.detail-card--indigo::before { background: linear-gradient(180deg, #6366f1, #4f46e5); }
.detail-header { padding: 24px; border-bottom: 1px solid var(--border); display: flex; align-items: flex-start; gap: 16px; }
.detail-info { flex: 1; }
.detail-title { font-size: 20px; font-weight: 600; color: var(--text-primary); margin-bottom: 4px; display: flex; align-items: center; gap: 10px; }
.detail-desc { font-size: 14px; color: var(--text-secondary); line-height: 1.6; }
.detail-actions { display: flex; gap: 8px; }

.detail-section { padding: 24px; border-bottom: 1px solid var(--border); }
.detail-section:last-child { border-bottom: none; }
.detail-section__title { font-size: 14px; font-weight: 600; color: var(--text-primary); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
.detail-section__content { background: var(--gray-900); border-radius: var(--radius-md); padding: 16px; color: #e2e8f0; font-family: 'Monaco', 'Menlo', monospace; font-size: 12px; line-height: 1.7; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }

/* Scrollbar */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--gray-300); border-radius: var(--radius-full); }
::-webkit-scrollbar-thumb:hover { background: var(--gray-400); }
    </style>
</head>

<body>
    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar__header">
                <div class="sidebar__logo">
                    <div class="sidebar__logo-icon">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                            <path d="M2 17l10 5 10-5M2 12l10 5 10-5"/>
                        </svg>
                    </div>
                    <span class="sidebar__logo-text">GrowFit</span>
                    <span class="sidebar__logo-badge">AI</span>
                </div>

                <!-- Class Selector -->
                <div class="class-selector">
                    <button class="class-selector__button" id="classButton" onclick="toggleClassDropdown()">
                        <div class="class-selector__icon">
                            <svg class="icon icon--sm" viewBox="0 0 24 24">
                                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                            </svg>
                        </div>
                        <div class="class-selector__info">
                            <div class="class-selector__name" id="selectedClassName">AI 기초 실습</div>
                            <div class="class-selector__meta">
                                <span class="class-selector__status class-selector__status--active" id="selectedClassStatus">
                                    <span class="class-selector__status-dot"></span><span id="selectedClassStatusText">진행 중</span>
                                </span>
                                <span class="class-selector__dday" id="selectedClassDday">D-15</span>
                            </div>
                        </div>
                        <svg class="icon icon--sm class-selector__arrow" viewBox="0 0 24 24">
                            <path d="M6 9l6 6 6-6"/>
                        </svg>
                    </button>

                    <div class="class-dropdown" id="classDropdown">
                        <div class="class-dropdown__section">
                            <div class="class-dropdown__section-title">진행 중인 클래스</div>
                            <div class="class-dropdown__item class-dropdown__item--active" data-class-id="class-1" onclick="selectClass('class-1', 'AI 기초 실습', 'active', 15)">
                                <div class="class-dropdown__item-icon class-dropdown__item-icon--active"><svg class="icon" viewBox="0 0 24 24"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg></div>
                                <div class="class-dropdown__item-info"><div class="class-dropdown__item-name">AI 기초 실습</div><div class="class-dropdown__item-period">2025.11.01 ~ 2025.12.01</div></div>
                                <span class="class-dropdown__item-badge class-dropdown__item-badge--active">D-15</span>
                            </div>
                            <div class="class-dropdown__item" data-class-id="class-2" onclick="selectClass('class-2', '프롬프트 엔지니어링', 'active', 30)">
                                <div class="class-dropdown__item-icon class-dropdown__item-icon--active"><svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg></div>
                                <div class="class-dropdown__item-info"><div class="class-dropdown__item-name">프롬프트 엔지니어링</div><div class="class-dropdown__item-period">2025.11.15 ~ 2025.12.15</div></div>
                                <span class="class-dropdown__item-badge class-dropdown__item-badge--active">D-30</span>
                            </div>
                        </div>
                        <div class="class-dropdown__divider"></div>
                        <div class="class-dropdown__section">
                            <div class="class-dropdown__section-title">종료된 클래스</div>
                            <div class="class-dropdown__item class-dropdown__item--disabled" onclick="selectClass('class-ended', '2024 AI 기초과정', 'ended', 0)">
                                <div class="class-dropdown__item-icon class-dropdown__item-icon--ended"><svg class="icon" viewBox="0 0 24 24"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg></div>
                                <div class="class-dropdown__item-info"><div class="class-dropdown__item-name">2024 AI 기초과정</div><div class="class-dropdown__item-period">2024.09.01 ~ 2024.10.31</div></div>
                                <span class="class-dropdown__item-badge class-dropdown__item-badge--ended">종료</span>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="sidebar__new-chat">
                    <svg class="icon icon--sm" viewBox="0 0 24 24">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    새 대화
                </button>
            </div>

            <nav class="sidebar__nav">
                <a class="sidebar__nav-item">
                    <span class="sidebar__nav-icon">
                        <svg class="icon" viewBox="0 0 24 24">
                            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                            <line x1="8" y1="21" x2="16" y2="21"/>
                            <line x1="12" y1="17" x2="12" y2="21"/>
                        </svg>
                    </span>
                    <span>AI 실습</span>
                </a>
                <a class="sidebar__nav-item">
                    <span class="sidebar__nav-icon">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                        </svg>
                    </span>
                    <span>내 프로젝트</span>
                </a>
                <a class="sidebar__nav-item">
                    <span class="sidebar__nav-icon">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                        </svg>
                    </span>
                    <span>지식베이스</span>
                </a>
                <a class="sidebar__nav-item sidebar__nav-item--active">
                    <span class="sidebar__nav-icon">
                        <svg class="icon" viewBox="0 0 24 24">
                            <rect x="3" y="11" width="18" height="10" rx="2"/>
                            <circle cx="12" cy="5" r="3"/>
                            <path d="M12 8v3"/>
                        </svg>
                    </span>
                    <span>내 에이전트</span>
                </a>
                <a class="sidebar__nav-item">
                    <span class="sidebar__nav-icon">
                        <svg class="icon" viewBox="0 0 24 24">
                            <polyline points="16 3 21 3 21 8"/>
                            <line x1="4" y1="20" x2="21" y2="3"/>
                            <polyline points="21 16 21 21 16 21"/>
                            <line x1="15" y1="15" x2="21" y2="21"/>
                            <line x1="4" y1="4" x2="9" y2="9"/>
                        </svg>
                    </span>
                    <span>워크플로우</span>
                </a>
                <a class="sidebar__nav-item">
                    <span class="sidebar__nav-icon">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                        </svg>
                    </span>
                    <span>내 기록</span>
                </a>
            </nav>

            <div class="sidebar__section-header">
                <span class="sidebar__section-title">최근 대화</span>
                <button class="sidebar__section-search" onclick="toggleChatSearch()">
                    <svg class="icon icon--sm" viewBox="0 0 24 24">
                        <circle cx="11" cy="11" r="8"/>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                    </svg>
                </button>
            </div>
            <div class="sidebar__history" id="chatHistory"></div>

            <div class="sidebar__footer">
                <div class="sidebar__footer-item">
                    <svg class="icon icon--sm" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                    <span>설정</span>
                </div>
                <div class="sidebar__user">
                    <div class="sidebar__user-avatar">홍</div>
                    <span class="sidebar__user-name">홍길동</span>
                    <svg class="icon icon--sm sidebar__logout" viewBox="0 0 24 24">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                        <polyline points="16 17 21 12 16 7"/>
                        <line x1="21" y1="12" x2="9" y2="12"/>
                    </svg>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main">
            <header class="page-header">
                <div class="page-header__left">
                    <h1 class="page-header__title">내 에이전트</h1>
                </div>
            </header>

            <div class="agent-content">
                <!-- Main View -->
                <div id="mainView">
                    <!-- Tabs -->
                    <div class="agent-tabs-wrapper">
                        <div class="agent-tabs">
                            <button class="agent-tab agent-tab--active" onclick="switchTab('template')" id="tabTemplate">
                                <svg class="icon icon--sm" viewBox="0 0 24 24">
                                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                                </svg>
                                학습 템플릿
                                <span class="agent-tab__count">5</span>
                            </button>
                            <button class="agent-tab" onclick="switchTab('my')" id="tabMy">
                                <svg class="icon icon--sm" viewBox="0 0 24 24">
                                    <rect x="3" y="11" width="18" height="10" rx="2"/>
                                    <circle cx="12" cy="5" r="3"/>
                                </svg>
                                내 에이전트
                                <span class="agent-tab__count">2</span>
                            </button>
                        </div>
                        <button class="btn btn--primary" id="newAgentBtn" onclick="openCreateModal()" style="display: none;">
                            <svg class="icon icon--sm" viewBox="0 0 24 24">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            새 에이전트
                        </button>
                    </div>

                    <!-- Stats Bar -->
                    <div class="stats-bar" id="statsBar">
                        <div class="stats-bar__item">
                            <div class="stats-bar__icon stats-bar__icon--total">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <rect x="3" y="11" width="18" height="10" rx="2"/>
                                    <circle cx="12" cy="5" r="3"/>
                                </svg>
                            </div>
                            <div class="stats-bar__info">
                                <span class="stats-bar__value" id="statTotal">2</span>
                                <span class="stats-bar__label">전체 에이전트</span>
                            </div>
                        </div>
                        <div class="stats-bar__item">
                            <div class="stats-bar__icon stats-bar__icon--active">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                    <polyline points="22 4 12 14.01 9 11.01"/>
                                </svg>
                            </div>
                            <div class="stats-bar__info">
                                <span class="stats-bar__value">1</span>
                                <span class="stats-bar__label">활성</span>
                            </div>
                        </div>
                        <div class="stats-bar__item">
                            <div class="stats-bar__icon" style="background: var(--gray-100); color: var(--gray-500);">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <circle cx="12" cy="12" r="10"/>
                                    <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/>
                                </svg>
                            </div>
                            <div class="stats-bar__info">
                                <span class="stats-bar__value">1</span>
                                <span class="stats-bar__label">비활성</span>
                            </div>
                        </div>
                    </div>

                    <!-- Toolbar -->
                    <div class="toolbar">
                        <div class="search-box">
                            <svg class="icon icon--sm search-box__icon" viewBox="0 0 24 24">
                                <circle cx="11" cy="11" r="8"/>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                            </svg>
                            <input type="text" class="search-box__input" placeholder="에이전트 검색..." oninput="filterAgents(this.value)">
                        </div>
                        
                        <div class="filter-dropdown" id="statusFilter" style="display: none;">
                            <button class="filter-dropdown__btn" onclick="toggleDropdown('status')">
                                <span id="statusLabel">전체 상태</span>
                                <svg class="icon icon--sm" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                            </button>
                            <div class="filter-dropdown__menu" id="statusMenu">
                                <div class="filter-dropdown__item selected" onclick="selectFilter('status', 'all', '전체 상태')">
                                    <svg class="icon icon--sm" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                                    전체 상태
                                </div>
                                <div class="filter-dropdown__item" onclick="selectFilter('status', 'active', '활성')">
                                    <svg class="icon icon--sm" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                                    활성
                                </div>
                                <div class="filter-dropdown__item" onclick="selectFilter('status', 'inactive', '비활성')">
                                    <svg class="icon icon--sm" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                                    비활성
                                </div>
                            </div>
                        </div>
                        
                        <div class="filter-dropdown" id="sortFilter">
                            <button class="filter-dropdown__btn" onclick="toggleDropdown('sort')">
                                <span id="sortLabel">최근 생성순</span>
                                <svg class="icon icon--sm" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                            </button>
                            <div class="filter-dropdown__menu" id="sortMenu">
                                <div class="filter-dropdown__item selected" onclick="selectFilter('sort', 'recent', '최근 생성순')">
                                    <svg class="icon icon--sm" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                                    최근 생성순
                                </div>
                                <div class="filter-dropdown__item" onclick="selectFilter('sort', 'oldest', '오래된순')">
                                    <svg class="icon icon--sm" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                                    오래된순
                                </div>
                                <div class="filter-dropdown__item" onclick="selectFilter('sort', 'name', '이름순')">
                                    <svg class="icon icon--sm" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                                    이름순
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Template Grid -->
                    <div id="templateGrid">
                        <!-- 플랫폼 템플릿 섹션 -->
                        <div class="template-section">
                            <div class="section-header">
                                <h3 class="section-header__title">
                                    <svg class="icon icon--sm" viewBox="0 0 24 24">
                                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                                        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                                    </svg>
                                    플랫폼 템플릿
                                </h3>
                            </div>
                            <div class="agent-grid">
                            <div class="agent-card agent-card--template agent-card--blue" onclick="viewTemplate('tutor')">
                                <div class="agent-card__header">
                                    <div class="agent-card__name">
                                        코딩 튜터
                                        <span class="agent-card__badge agent-card__badge--template">템플릿</span>
                                    </div>
                                    <div class="agent-card__desc">Python, JavaScript 등 프로그래밍 언어를 친절하게 가르치는 튜터 에이전트입니다.</div>
                                </div>
                                <div class="agent-card__footer-hint">
                                    <svg class="icon icon--sm" viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                                    클릭하여 프롬프트 구조 분석하기
                                </div>
                            </div>

                            <div class="agent-card agent-card--template agent-card--pink" onclick="viewTemplate('writer')">
                                <div class="agent-card__header">
                                    <div class="agent-card__name">
                                        콘텐츠 작가
                                        <span class="agent-card__badge agent-card__badge--template">템플릿</span>
                                    </div>
                                    <div class="agent-card__desc">블로그, 마케팅 문구 등 다양한 콘텐츠를 작성하는 전문 작가 에이전트입니다.</div>
                                </div>
                                <div class="agent-card__footer-hint">
                                    <svg class="icon icon--sm" viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                                    클릭하여 프롬프트 구조 분석하기
                                </div>
                            </div>

                            <div class="agent-card agent-card--template agent-card--green" onclick="viewTemplate('translator')">
                                <div class="agent-card__header">
                                    <div class="agent-card__name">
                                        전문 번역가
                                        <span class="agent-card__badge agent-card__badge--template">템플릿</span>
                                    </div>
                                    <div class="agent-card__desc">영어, 일본어, 중국어 등 다국어 번역을 전문으로 하는 번역가 에이전트입니다.</div>
                                </div>
                                <div class="agent-card__footer-hint">
                                    <svg class="icon icon--sm" viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                                    클릭하여 프롬프트 구조 분석하기
                                </div>
                            </div>
                            </div>
                        </div>

                        <!-- 강사 공유 템플릿 섹션 -->
                        <div class="template-section template-section--instructor">
                            <div class="section-header">
                                <h3 class="section-header__title">
                                    <svg class="icon icon--sm" viewBox="0 0 24 24">
                                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                        <circle cx="9" cy="7" r="4"/>
                                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                                    </svg>
                                    강사 공유 템플릿
                                </h3>
                            </div>
                            <div class="agent-grid">
                            <div class="agent-card agent-card--template agent-card--orange" onclick="viewTemplate('marketing')">
                                <div class="agent-card__header">
                                    <div class="agent-card__name">
                                        마케팅 분석가
                                        <span class="agent-card__badge agent-card__badge--instructor">강사</span>
                                    </div>
                                    <div class="agent-card__desc">마케팅 데이터를 분석하고 캠페인 전략을 제안하는 분석 전문 에이전트입니다.</div>
                                </div>
                                <div class="agent-card__footer-hint">
                                    <svg class="icon icon--sm" viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                                    클릭하여 프롬프트 구조 분석하기
                                </div>
                            </div>

                            <div class="agent-card agent-card--template agent-card--indigo" onclick="viewTemplate('customer')">
                                <div class="agent-card__header">
                                    <div class="agent-card__name">
                                        고객 응대 봇
                                        <span class="agent-card__badge agent-card__badge--instructor">강사</span>
                                    </div>
                                    <div class="agent-card__desc">친절하고 전문적으로 고객 문의에 응대하는 CS 전문 에이전트입니다.</div>
                                </div>
                                <div class="agent-card__footer-hint">
                                    <svg class="icon icon--sm" viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                                    클릭하여 프롬프트 구조 분석하기
                                </div>
                            </div>
                            </div>
                        </div>
                    </div>

                    <!-- My Agent Grid (Hidden by default) -->
                    <div class="agent-grid" id="myAgentGrid" style="display: none;">
                        <div class="agent-card agent-card--purple">
                            <div class="agent-card__toggle">
                                <label class="toggle-switch">
                                    <input type="checkbox" checked onchange="toggleAgentStatus('my-tutor', this.checked)">
                                    <span class="toggle-switch__slider"></span>
                                </label>
                            </div>
                            <div class="agent-card__header">
                                <div class="agent-card__name">
                                    나만의 코딩 도우미
                                    <span class="agent-card__badge agent-card__badge--active">활성</span>
                                </div>
                                <div class="agent-card__desc">코딩 튜터를 기반으로 커스터마이징한 나만의 프로그래밍 학습 도우미입니다.</div>
                            </div>
                            <div class="agent-card__meta">
                                <div class="agent-card__stat">
                                    <svg viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                                    2025.01.15 생성
                                </div>
                            </div>
                            <div class="agent-card__actions">
                                <button class="agent-card__btn agent-card__btn--outline" onclick="editAgent('my-tutor')">
                                    <svg class="icon icon--sm" viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                                    수정
                                </button>
                                <button class="agent-card__btn agent-card__btn--danger" onclick="deleteAgent('my-tutor')">
                                    <svg class="icon icon--sm" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                                    삭제
                                </button>
                            </div>
                        </div>

                        <div class="agent-card agent-card--teal agent-card--inactive">
                            <div class="agent-card__toggle">
                                <label class="toggle-switch">
                                    <input type="checkbox" onchange="toggleAgentStatus('email-helper', this.checked)">
                                    <span class="toggle-switch__slider"></span>
                                </label>
                            </div>
                            <div class="agent-card__header">
                                <div class="agent-card__name">
                                    이메일 작성 도우미
                                    <span class="agent-card__badge agent-card__badge--inactive">비활성</span>
                                </div>
                                <div class="agent-card__desc">비즈니스 이메일을 전문적이고 정중하게 작성해주는 도우미입니다.</div>
                            </div>
                            <div class="agent-card__meta">
                                <div class="agent-card__stat">
                                    <svg viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                                    2025.01.10 생성
                                </div>
                            </div>
                            <div class="agent-card__actions">
                                <button class="agent-card__btn agent-card__btn--outline" onclick="editAgent('email-helper')">
                                    <svg class="icon icon--sm" viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                                    수정
                                </button>
                                <button class="agent-card__btn agent-card__btn--danger" onclick="deleteAgent('email-helper')">
                                    <svg class="icon icon--sm" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                                    삭제
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pagination -->
                    <div class="pagination" id="pagination" style="display: none;">
                        <button class="pagination__btn" disabled>
                            <svg class="icon icon--sm" viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg>
                            이전
                        </button>
                        <div class="pagination__pages">
                            <button class="pagination__page pagination__page--active">1</button>
                            <button class="pagination__page">2</button>
                            <button class="pagination__page">3</button>
                        </div>
                        <button class="pagination__btn">
                            다음
                            <svg class="icon icon--sm" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg>
                        </button>
                    </div>
                </div>

                <!-- Template Detail View -->
                <div class="template-detail" id="templateDetail">
                    <div class="detail-back" onclick="backToList()">
                        <svg class="icon icon--sm" viewBox="0 0 24 24">
                            <line x1="19" y1="12" x2="5" y2="12"/>
                            <polyline points="12 19 5 12 12 5"/>
                        </svg>
                        목록으로 돌아가기
                    </div>

                    <div class="detail-card" id="detailCard">
                        <div class="detail-header">
                            <div class="detail-info">
                                <h2 class="detail-title" id="detailTitle">
                                    코딩 튜터
                                    <span class="agent-card__badge agent-card__badge--template">템플릿</span>
                                </h2>
                                <p class="detail-desc" id="detailDesc">Python, JavaScript 등 프로그래밍 언어를 친절하게 가르치는 튜터 에이전트입니다.</p>
                            </div>
                            <div class="detail-actions">
                                <button class="btn btn--primary" onclick="copyTemplate(currentTemplate)">
                                    <svg class="icon icon--sm" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                                    이 템플릿으로 내 에이전트 만들기
                                </button>
                            </div>
                        </div>

                        <div class="detail-section">
                            <h3 class="detail-section__title">
                                <svg class="icon icon--sm" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                                시스템 프롬프트 분석
                            </h3>
                            <div class="detail-section__content" id="detailPrompt">[역할 (Role)]
당신은 10년 경력의 시니어 개발자이자 프로그래밍 교육 전문가입니다.
학생들에게 프로그래밍 개념을 명확하고 이해하기 쉽게 설명하는 것이 당신의 역할입니다.

[전문성 (Expertise)]
- Python, JavaScript, Java 등 주요 프로그래밍 언어
- 알고리즘과 자료구조
- 코드 디버깅 및 최적화
- 베스트 프랙티스 및 설계 패턴

[톤 & 스타일 (Tone)]
- 친근하고 격려하는 톤
- 복잡한 개념을 단순하게 설명
- 비유와 예시를 적극 활용
- 학생의 이해도를 확인하며 진행

[제약 조건 (Constraints)]
- 코드 예제는 항상 주석과 함께 제공
- 단계별로 설명하여 이해를 돕기
- 학생이 스스로 생각할 수 있도록 힌트 제공
- 오류가 있을 때는 직접 답을 주기보다 디버깅 방법 안내</div>
                        </div>

                        <div class="detail-section">
                            <h3 class="detail-section__title">
                                <svg class="icon icon--sm" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                                학습 포인트
                            </h3>
                            <div class="guide-box" style="margin: 0;">
                                <div class="guide-box__list">
                                    <div class="guide-box__item">
                                        <svg class="icon icon--sm guide-box__item-icon" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                                        <span><strong>역할 명시:</strong> AI가 어떤 전문가인지 구체적으로 정의합니다</span>
                                    </div>
                                    <div class="guide-box__item">
                                        <svg class="icon icon--sm guide-box__item-icon" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                                        <span><strong>전문성 나열:</strong> 담당할 수 있는 영역을 명확히 합니다</span>
                                    </div>
                                    <div class="guide-box__item">
                                        <svg class="icon icon--sm guide-box__item-icon" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                                        <span><strong>톤 지정:</strong> 응답의 분위기와 말투를 설정합니다</span>
                                    </div>
                                    <div class="guide-box__item">
                                        <svg class="icon icon--sm guide-box__item-icon" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                                        <span><strong>제약 조건:</strong> 하지 말아야 할 것들을 명시합니다</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Chat Context Menu -->
        <div class="context-menu" id="chatContextMenu">
            <div class="context-menu__item" onclick="renameChat()"><svg class="icon icon--sm" viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>이름 변경</div>
            <div class="context-menu__item" id="pinChatItem" onclick="togglePinChat()"><svg class="icon icon--sm" viewBox="0 0 24 24"><path d="M12 17v5"/><path d="M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4.76z"/></svg><span id="pinChatText">고정</span></div>
            <div class="context-menu__divider" id="projectMenuDivider" style="display: none;"></div>
            <div class="context-menu__item context-menu__item--project-add" id="addToProjectItem" style="display: none;" onclick="addChatToProject()"><svg class="icon icon--sm" viewBox="0 0 24 24"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/><line x1="12" y1="11" x2="12" y2="17"/><line x1="9" y1="14" x2="15" y2="14"/></svg>프로젝트 추가</div>
            <div class="context-menu__item context-menu__item--project-change" id="changeProjectItem" style="display: none;" onclick="changeChatProject()"><svg class="icon icon--sm" viewBox="0 0 24 24"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/><path d="M12 11v6"/><path d="M9 14h6"/></svg>프로젝트 변경</div>
            <div class="context-menu__item context-menu__item--project-remove" id="removeFromProjectItem" style="display: none;" onclick="removeChatFromProject()"><svg class="icon icon--sm" viewBox="0 0 24 24"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/><line x1="9" y1="14" x2="15" y2="14"/></svg>프로젝트에서 제거</div>
            <div class="context-menu__divider"></div>
            <div class="context-menu__item context-menu__item--danger" onclick="deleteChat()"><svg class="icon icon--sm" viewBox="0 0 24 24"><path d="M3 6h18"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>삭제</div>
        </div>
    </div>

    <!-- Create/Edit Agent Modal -->
    <div class="modal-overlay" id="agentModal">
        <div class="modal">
            <div class="modal__header">
                <h2 class="modal__title" id="modalTitle">새 에이전트 만들기</h2>
                <button class="modal__close" onclick="closeModal()">
                    <svg class="icon" viewBox="0 0 24 24">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal__body">
                <!-- Guide Box -->
                <div class="guide-box">
                    <div class="guide-box__title">
                        <svg class="icon icon--sm" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                        프롬프트 작성 가이드
                    </div>
                    <div class="guide-box__list">
                        <div class="guide-box__item">
                            <svg class="icon icon--sm guide-box__item-icon" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                            <span><strong>[역할]</strong> AI가 어떤 전문가인지 정의하세요</span>
                        </div>
                        <div class="guide-box__item">
                            <svg class="icon icon--sm guide-box__item-icon" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                            <span><strong>[전문성]</strong> 담당 영역과 능력을 나열하세요</span>
                        </div>
                        <div class="guide-box__item">
                            <svg class="icon icon--sm guide-box__item-icon" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                            <span><strong>[톤 & 스타일]</strong> 응답 방식과 말투를 지정하세요</span>
                        </div>
                        <div class="guide-box__item">
                            <svg class="icon icon--sm guide-box__item-icon" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                            <span><strong>[제약 조건]</strong> 하지 말아야 할 것들을 명시하세요</span>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group form-group--color">
                        <label class="form-label">색상</label>
                        <div class="color-picker" id="colorPicker">
                            <button type="button" class="color-picker__item color-picker__item--active" data-color="purple" style="background: linear-gradient(135deg, #a855f7, #7c3aed);"></button>
                            <button type="button" class="color-picker__item" data-color="blue" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></button>
                            <button type="button" class="color-picker__item" data-color="teal" style="background: linear-gradient(135deg, #14b8a6, #0d9488);"></button>
                            <button type="button" class="color-picker__item" data-color="green" style="background: linear-gradient(135deg, #22c55e, #16a34a);"></button>
                            <button type="button" class="color-picker__item" data-color="orange" style="background: linear-gradient(135deg, #f97316, #ea580c);"></button>
                            <button type="button" class="color-picker__item" data-color="pink" style="background: linear-gradient(135deg, #ec4899, #db2777);"></button>
                            <button type="button" class="color-picker__item" data-color="red" style="background: linear-gradient(135deg, #ef4444, #dc2626);"></button>
                            <button type="button" class="color-picker__item" data-color="indigo" style="background: linear-gradient(135deg, #6366f1, #4f46e5);"></button>
                        </div>
                    </div>
                    <div class="form-group form-group--name">
                        <label class="form-label">
                            에이전트 이름
                            <span class="form-label__required">*</span>
                        </label>
                        <input type="text" class="form-input" id="agentName" placeholder="예: 코딩 튜터, 마케팅 전문가">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">간단한 설명</label>
                    <input type="text" class="form-input" id="agentDesc" placeholder="이 에이전트가 어떤 일을 하는지 간단히 설명하세요">
                </div>

                <div class="form-group">
                    <label class="form-label">
                        시스템 프롬프트
                        <span class="form-label__required">*</span>
                    </label>
                    <textarea class="form-input form-textarea form-textarea--code" id="agentPrompt" placeholder="[역할 (Role)]
당신은 ...

[전문성 (Expertise)]
- ...

[톤 & 스타일 (Tone)]
- ...

[제약 조건 (Constraints)]
- ..."></textarea>
                    <div class="form-hint">구체적이고 명확하게 작성할수록 에이전트가 더 일관성 있게 동작합니다</div>
                </div>
            </div>
            <div class="modal__footer">
                <button class="btn btn--outline" onclick="closeModal()">취소</button>
                <button class="btn btn--primary" onclick="saveAgent()">
                    <svg class="icon icon--sm" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                    저장
                </button>
            </div>
        </div>
    </div>

    <!-- General Modal Overlay -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeGeneralModal()">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal__header">
                <h3 class="modal__title" id="generalModalTitle">모달 제목</h3>
                <button class="modal__close" onclick="closeGeneralModal()">
                    <svg class="icon" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
            </div>
            <div class="modal__body" id="generalModalBody"></div>
            <div class="modal__footer" id="generalModalFooter"></div>
        </div>
    </div>

    <script>
// ========== Recent Chats Data & Functions ==========
let chatData = [
    { id: 1, title: '프롬프트 엔지니어링 ...', time: '2분 전', active: true, pinned: true, projectId: 'proj-1', projectName: 'AI 기초' },
    { id: 2, title: 'GPT vs Claude 비교', time: '1시간 전', active: false, pinned: false, projectId: 'proj-1', projectName: 'AI 기초' },
    { id: 3, title: '마케팅 문구 생성', time: '어제', active: false, pinned: false, projectId: null, projectName: null },
    { id: 4, title: '코드 리뷰 요청', time: '2일 전', active: false, pinned: false, projectId: null, projectName: null }
];

// ========== PopupState for Project Selection ==========
const PopupState = {
    projects: {
        displayCount: 10,
        searchQuery: '',
        sortBy: 'recent',
        data: [
            { id: 'proj-1', name: 'AI 기초 실습 프로젝트', color: '#9333ea', chatCount: 5, updatedAt: '2시간 전', updatedTime: Date.now() - 7200000 },
            { id: 'proj-2', name: '프롬프트 엔지니어링', color: '#4285f4', chatCount: 8, updatedAt: '1일 전', updatedTime: Date.now() - 86400000 },
            { id: 'proj-3', name: '마케팅 문구 생성', color: '#d97757', chatCount: 3, updatedAt: '3일 전', updatedTime: Date.now() - 259200000 },
            { id: 'proj-4', name: 'GPT vs Claude 비교분석', color: '#10a37f', chatCount: 12, updatedAt: '5일 전', updatedTime: Date.now() - 432000000 },
            { id: 'proj-5', name: '코드 리팩토링 실습', color: '#a50034', chatCount: 7, updatedAt: '1주 전', updatedTime: Date.now() - 604800000 },
            { id: 'proj-6', name: '영어 번역 프로젝트', color: '#f59e0b', chatCount: 15, updatedAt: '1주 전', updatedTime: Date.now() - 691200000 },
            { id: 'proj-7', name: '데이터 분석 연습', color: '#06b6d4', chatCount: 9, updatedAt: '2주 전', updatedTime: Date.now() - 1209600000 },
            { id: 'proj-8', name: '챗봇 시나리오 작성', color: '#8b5cf6', chatCount: 4, updatedAt: '2주 전', updatedTime: Date.now() - 1296000000 }
        ]
    },
    addToProject: {
        chatId: null,
        selectedProjectId: null,
        searchQuery: '',
        displayCount: 10
    },
    changeProject: {
        chatId: null,
        currentProjectId: null,
        selectedProjectId: null,
        searchQuery: '',
        displayCount: 10
    }
};

let confirmCallback = null;

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text || '';
    return div.innerHTML;
}

function renderChatHistory() {
    const history = document.getElementById('chatHistory');
    if (!history) return;
    
    // 고정된 대화를 위로 정렬
    const sortedChats = [...chatData].sort((a, b) => {
        if (a.pinned && !b.pinned) return -1;
        if (!a.pinned && b.pinned) return 1;
        return 0;
    });
    
    history.innerHTML = sortedChats.map(chat => `
        <div class="chat-item ${chat.active ? 'chat-item--active' : ''}" onclick="loadChat(${chat.id})" data-chat-id="${chat.id}" data-project-id="${chat.projectId || ''}" data-project-name="${chat.projectName || ''}" data-pinned="${chat.pinned}">
            ${chat.pinned ? '<div class="chat-item__pin-dot"></div>' : ''}
            <div class="chat-item__icon">
                <svg class="icon icon--sm" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
            </div>
            <div class="chat-item__info">
                <div class="chat-item__title">${escapeHtml(chat.title)}</div>
                <div class="chat-item__meta">
                    <span class="chat-item__time">${chat.time}</span>
                    ${chat.projectName ? `<span class="chat-item__project-badge"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>${chat.projectName}</span>` : ''}
                </div>
            </div>
            <button class="chat-item__menu" onclick="event.stopPropagation(); showChatContextMenu(event, ${chat.id}, ${chat.projectId ? `'${chat.projectId}'` : 'null'}, ${chat.pinned})"><svg class="icon icon--sm" viewBox="0 0 24 24"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></svg></button>
        </div>
    `).join('');
}

// ========== Chat Context Menu ==========
function showChatContextMenu(event, chatId, projectId = null, isPinned = false) {
    const menu = document.getElementById('chatContextMenu');
    menu.style.left = event.clientX + 'px';
    menu.style.top = event.clientY + 'px';
    menu.classList.add('context-menu--open');
    menu.dataset.chatId = chatId;
    menu.dataset.projectId = projectId || '';
    menu.dataset.pinned = isPinned;
    
    // 고정/고정 해제 텍스트 변경
    const pinText = document.getElementById('pinChatText');
    if (pinText) {
        pinText.textContent = isPinned ? '고정 해제' : '고정';
    }
    
    // 프로젝트 관련 메뉴 항목 표시/숨김 처리
    const divider = document.getElementById('projectMenuDivider');
    const addToProjectItem = document.getElementById('addToProjectItem');
    const changeProjectItem = document.getElementById('changeProjectItem');
    const removeFromProjectItem = document.getElementById('removeFromProjectItem');
    
    if (projectId) {
        // 프로젝트에 속한 대화
        divider.style.display = 'block';
        addToProjectItem.style.display = 'none';
        changeProjectItem.style.display = 'flex';
        removeFromProjectItem.style.display = 'flex';
    } else {
        // 프로젝트에 속하지 않은 대화
        divider.style.display = 'block';
        addToProjectItem.style.display = 'flex';
        changeProjectItem.style.display = 'none';
        removeFromProjectItem.style.display = 'none';
    }
}

function closeChatContextMenu() { 
    document.getElementById('chatContextMenu').classList.remove('context-menu--open'); 
}

function loadChat(chatId) {
    // 모든 대화 비활성화
    chatData.forEach(c => c.active = false);
    // 선택한 대화 활성화
    const chat = chatData.find(c => c.id === chatId);
    if (chat) {
        chat.active = true;
    }
    renderChatHistory();
}

function renameChat() {
    const menu = document.getElementById('chatContextMenu');
    const chatId = parseInt(menu.dataset.chatId);
    const chat = chatData.find(c => c.id === chatId);
    closeChatContextMenu();
    
    if (chat) {
        openRenameModal(chatId, chat.title);
    }
}

function openRenameModal(chatId, currentName) {
    const modalContent = `
        <div style="padding: 20px;">
            <div style="margin-bottom: 16px;">
                <label style="display: block; font-size: 13px; font-weight: 500; color: var(--text-secondary); margin-bottom: 8px;">새 이름</label>
                <input type="text" id="renameInput" value="${escapeHtml(currentName)}" 
                    style="width: 100%; padding: 10px 12px; border: 1px solid var(--border); border-radius: var(--radius-md); font-size: 14px; font-family: var(--font-sans);"
                    onkeydown="if(event.key==='Enter') executeRename(${chatId})">
            </div>
        </div>
        <div style="display: flex; gap: 8px; padding: 16px 20px; border-top: 1px solid var(--border); background: var(--gray-50);">
            <button class="modal__btn" style="flex: 1;" onclick="closeGeneralModal()">취소</button>
            <button class="modal__btn modal__btn--primary" style="flex: 1;" onclick="executeRename(${chatId})">변경</button>
        </div>
    `;
    
    document.getElementById('generalModalTitle').innerHTML = '';
    document.getElementById('generalModalBody').innerHTML = modalContent;
    document.getElementById('generalModalFooter').style.display = 'none';
    document.querySelector('#modalOverlay .modal').classList.add('modal--popup');
    document.getElementById('modalOverlay').classList.add('modal-overlay--open');
    
    // 입력 필드에 포커스
    setTimeout(() => {
        const input = document.getElementById('renameInput');
        if (input) {
            input.focus();
            input.select();
        }
    }, 100);
}

function executeRename(chatId) {
    const input = document.getElementById('renameInput');
    const newName = input ? input.value.trim() : '';
    
    if (newName) {
        const chat = chatData.find(c => c.id === chatId);
        if (chat) {
            chat.title = newName;
            showToast('이름이 변경되었습니다', 'success');
            renderChatHistory();
        }
    }
    closeGeneralModal();
}

function deleteChat() {
    const menu = document.getElementById('chatContextMenu');
    const chatId = parseInt(menu.dataset.chatId);
    const chat = chatData.find(c => c.id === chatId);
    closeChatContextMenu();
    
    openConfirmModal(
        '대화 삭제',
        `"${chat ? chat.title : '이 대화'}"를 삭제하시겠습니까?`,
        '삭제',
        'danger',
        () => {
            chatData = chatData.filter(c => c.id !== chatId);
            showToast('대화가 삭제되었습니다', 'success');
            renderChatHistory();
        }
    );
}

function openConfirmModal(title, message, confirmText, type, callback) {
    confirmCallback = callback;
    
    const iconColor = type === 'danger' ? 'var(--error)' : type === 'warning' ? 'var(--warning)' : 'var(--primary-600)';
    const iconBg = type === 'danger' ? '#fef2f2' : type === 'warning' ? '#fffbeb' : 'var(--primary-100)';
    const btnClass = type === 'danger' ? 'modal__btn--danger' : 'modal__btn--primary';
    
    const modalContent = `
        <div style="text-align: center; padding: 20px;">
            <div style="width: 48px; height: 48px; background: ${iconBg}; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px;">
                <svg style="width: 24px; height: 24px; color: ${iconColor};" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    ${type === 'danger' ? '<path d="M3 6h18"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>' : '<circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>'}
                </svg>
            </div>
            <h3 style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px;">${title}</h3>
            <p style="font-size: 14px; color: var(--text-secondary); line-height: 1.5;">${message}</p>
        </div>
        <div style="display: flex; gap: 8px; padding: 16px 20px; border-top: 1px solid var(--border); background: var(--gray-50);">
            <button class="modal__btn" style="flex: 1;" onclick="closeGeneralModal()">취소</button>
            <button class="modal__btn ${btnClass}" style="flex: 1;" onclick="executeConfirm()">${confirmText}</button>
        </div>
    `;
    
    document.getElementById('generalModalTitle').innerHTML = '';
    document.getElementById('generalModalBody').innerHTML = modalContent;
    document.getElementById('generalModalFooter').style.display = 'none';
    document.querySelector('#modalOverlay .modal').classList.add('modal--popup');
    document.getElementById('modalOverlay').classList.add('modal-overlay--open');
}

function executeConfirm() {
    const callback = confirmCallback;
    closeGeneralModal();
    if (callback) {
        callback();
    }
}

function closeGeneralModal() {
    document.getElementById('modalOverlay').classList.remove('modal-overlay--open');
    document.querySelector('#modalOverlay .modal').classList.remove('modal--popup');
    confirmCallback = null;
}

function togglePinChat() {
    const menu = document.getElementById('chatContextMenu');
    const chatId = parseInt(menu.dataset.chatId);
    const isPinned = menu.dataset.pinned === 'true';
    closeChatContextMenu();
    
    // 실제 데이터 업데이트
    const chat = chatData.find(c => c.id === chatId);
    if (chat) {
        chat.pinned = !isPinned;
    }
    
    if (isPinned) {
        showToast('고정이 해제되었습니다', 'success');
    } else {
        showToast('대화가 고정되었습니다', 'success');
    }
    renderChatHistory();
}

function addChatToProject() {
    const menu = document.getElementById('chatContextMenu');
    const chatId = menu.dataset.chatId;
    closeChatContextMenu();
    
    // 팝업 상태 초기화
    PopupState.addToProject = {
        chatId: chatId,
        selectedProjectId: null,
        searchQuery: '',
        displayCount: 10
    };
    
    openAddToProjectPopup();
}

function openAddToProjectPopup() {
    const state = PopupState.addToProject;
    
    // 필터링 및 정렬
    let filteredProjects = [...PopupState.projects.data];
    if (state.searchQuery) {
        const query = state.searchQuery.toLowerCase();
        filteredProjects = filteredProjects.filter(p => p.name.toLowerCase().includes(query));
    }
    filteredProjects.sort((a, b) => b.updatedTime - a.updatedTime);
    
    const displayedProjects = filteredProjects.slice(0, state.displayCount);
    const hasMore = filteredProjects.length > state.displayCount;
    const remaining = filteredProjects.length - state.displayCount;
    
    const modalContent = `
        <div class="popup-header">
            <div class="popup-header__icon popup-header__icon--green">
                <svg class="icon" viewBox="0 0 24 24"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/><line x1="12" y1="11" x2="12" y2="17"/><line x1="9" y1="14" x2="15" y2="14"/></svg>
            </div>
            <div class="popup-header__text">
                <div class="popup-header__title">프로젝트에 추가</div>
                <div class="popup-header__subtitle">대화를 프로젝트에 저장</div>
            </div>
            <button class="popup-close" onclick="closeGeneralModal()">
                <svg class="icon" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
        </div>
        
        <div class="popup-search-bar">
            <div class="popup-search" style="flex: 1;">
                <svg class="icon icon--sm popup-search__icon" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                <input type="text" class="popup-search__input" placeholder="프로젝트 검색..." value="${state.searchQuery}" oninput="filterAddToProject(this.value)">
            </div>
        </div>
        
        <div class="popup-list" id="addToProjectList">
            ${displayedProjects.length > 0 ? displayedProjects.map(proj => {
                const isSelected = proj.id === state.selectedProjectId;
                return `
                <div class="popup-item ${isSelected ? 'popup-item--selected' : ''}" onclick="selectAddToProject('${proj.id}')">
                    <div class="popup-item__radio">
                        <div class="popup-item__radio-dot"></div>
                    </div>
                    <div class="popup-item__color" style="background: ${proj.color}"></div>
                    <div class="popup-item__info">
                        <div class="popup-item__name">${escapeHtml(proj.name)}</div>
                        <div class="popup-item__meta">
                            <span>대화 ${proj.chatCount}개</span>
                            <span>•</span>
                            <span>${proj.updatedAt}</span>
                        </div>
                    </div>
                </div>
            `}).join('') : `
                <div class="popup-list__empty">
                    <p>검색 결과가 없습니다</p>
                </div>
            `}
            
            ${hasMore ? `
                <div class="popup-loadmore">
                    <button class="popup-loadmore__btn" onclick="loadMoreAddToProject()">
                        더보기 (${remaining}개 더 있음)
                    </button>
                </div>
            ` : ''}
        </div>
        
        <div class="popup-footer">
            <button class="popup-footer__btn" onclick="closeGeneralModal()">취소</button>
            <button class="popup-footer__btn popup-footer__btn--primary" onclick="confirmAddToProjectPopup()" ${!state.selectedProjectId ? 'disabled' : ''}>
                추가하기
            </button>
        </div>
    `;
    
    document.getElementById('generalModalTitle').innerHTML = '';
    document.getElementById('generalModalBody').innerHTML = modalContent;
    document.getElementById('generalModalFooter').style.display = 'none';
    document.querySelector('#modalOverlay .modal').classList.add('modal--popup');
    document.getElementById('modalOverlay').classList.add('modal-overlay--open');
}

function filterAddToProject(query) {
    PopupState.addToProject.searchQuery = query;
    PopupState.addToProject.displayCount = 10;
    openAddToProjectPopup();
}

function selectAddToProject(projectId) {
    PopupState.addToProject.selectedProjectId = projectId;
    openAddToProjectPopup();
}

function loadMoreAddToProject() {
    PopupState.addToProject.displayCount += 10;
    openAddToProjectPopup();
}

function confirmAddToProjectPopup() {
    const state = PopupState.addToProject;
    const project = PopupState.projects.data.find(p => p.id === state.selectedProjectId);
    
    if (project) {
        confirmAddToProject(state.chatId, project.id, project.name);
    }
}

function confirmAddToProject(chatId, projectId, projectName) {
    closeGeneralModal();
    // 실제 데이터 업데이트
    const chat = chatData.find(c => c.id === parseInt(chatId));
    if (chat) {
        chat.projectId = projectId;
        chat.projectName = projectName;
    }
    showToast(`"${projectName}" 프로젝트에 추가되었습니다`, 'success');
    renderChatHistory();
}

function changeChatProject() {
    const menu = document.getElementById('chatContextMenu');
    const chatId = menu.dataset.chatId;
    const currentProjectId = menu.dataset.projectId;
    closeChatContextMenu();
    
    // 팝업 상태 초기화
    PopupState.changeProject = {
        chatId: chatId,
        currentProjectId: currentProjectId,
        selectedProjectId: null,
        searchQuery: '',
        displayCount: 10
    };
    
    openChangeProjectPopup();
}

function openChangeProjectPopup() {
    const state = PopupState.changeProject;
    const currentProject = PopupState.projects.data.find(p => p.id === state.currentProjectId);
    
    // 필터링 및 정렬
    let filteredProjects = [...PopupState.projects.data];
    if (state.searchQuery) {
        const query = state.searchQuery.toLowerCase();
        filteredProjects = filteredProjects.filter(p => p.name.toLowerCase().includes(query));
    }
    filteredProjects.sort((a, b) => b.updatedTime - a.updatedTime);
    
    const displayedProjects = filteredProjects.slice(0, state.displayCount);
    const hasMore = filteredProjects.length > state.displayCount;
    const remaining = filteredProjects.length - state.displayCount;
    
    const modalContent = `
        <div class="popup-header">
            <div class="popup-header__icon popup-header__icon--blue">
                <svg class="icon" viewBox="0 0 24 24"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/><path d="M12 11v6"/><path d="M9 14l3 3 3-3"/></svg>
            </div>
            <div class="popup-header__text">
                <div class="popup-header__title">프로젝트 변경</div>
                <div class="popup-header__subtitle">대화를 다른 프로젝트로 이동</div>
            </div>
            <button class="popup-close" onclick="closeGeneralModal()">
                <svg class="icon" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
        </div>
        
        ${currentProject ? `
            <div class="popup-current-banner">
                <svg class="icon popup-current-banner__icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
                현재 위치: <strong>${escapeHtml(currentProject.name)}</strong>
            </div>
        ` : ''}
        
        <div class="popup-search-bar">
            <div class="popup-search" style="flex: 1;">
                <svg class="icon icon--sm popup-search__icon" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                <input type="text" class="popup-search__input" placeholder="프로젝트 검색..." value="${state.searchQuery}" oninput="filterChangeProject(this.value)">
            </div>
        </div>
        
        <div class="popup-list" id="changeProjectList">
            ${displayedProjects.length > 0 ? displayedProjects.map(proj => {
                const isCurrent = proj.id === state.currentProjectId;
                const isSelected = proj.id === state.selectedProjectId;
                return `
                <div class="popup-item ${isCurrent ? 'popup-item--current' : ''} ${isSelected ? 'popup-item--selected' : ''}" 
                     onclick="${isCurrent ? '' : `selectChangeProject('${proj.id}')`}">
                    <div class="popup-item__radio">
                        <div class="popup-item__radio-dot"></div>
                    </div>
                    <div class="popup-item__color" style="background: ${proj.color}"></div>
                    <div class="popup-item__info">
                        <div class="popup-item__name">
                            ${escapeHtml(proj.name)}
                            ${isCurrent ? '<span class="popup-item__badge popup-item__badge--current">현재</span>' : ''}
                        </div>
                        <div class="popup-item__meta">
                            <span>대화 ${proj.chatCount}개</span>
                            <span>•</span>
                            <span>${proj.updatedAt}</span>
                        </div>
                    </div>
                </div>
            `}).join('') : `
                <div class="popup-list__empty">
                    <p>검색 결과가 없습니다</p>
                </div>
            `}
            
            ${hasMore ? `
                <div class="popup-loadmore">
                    <button class="popup-loadmore__btn" onclick="loadMoreChangeProject()">
                        더보기 (${remaining}개 더 있음)
                    </button>
                </div>
            ` : ''}
        </div>
        
        <div class="popup-footer">
            <button class="popup-footer__btn" onclick="closeGeneralModal()">취소</button>
            <button class="popup-footer__btn popup-footer__btn--primary" onclick="confirmChangeProjectPopup()" ${!state.selectedProjectId ? 'disabled' : ''}>
                이동하기
            </button>
        </div>
    `;
    
    document.getElementById('generalModalTitle').innerHTML = '';
    document.getElementById('generalModalBody').innerHTML = modalContent;
    document.getElementById('generalModalFooter').style.display = 'none';
    document.querySelector('#modalOverlay .modal').classList.add('modal--popup');
    document.getElementById('modalOverlay').classList.add('modal-overlay--open');
}

function filterChangeProject(query) {
    PopupState.changeProject.searchQuery = query;
    PopupState.changeProject.displayCount = 10;
    openChangeProjectPopup();
}

function selectChangeProject(projectId) {
    PopupState.changeProject.selectedProjectId = projectId;
    openChangeProjectPopup();
}

function loadMoreChangeProject() {
    PopupState.changeProject.displayCount += 10;
    openChangeProjectPopup();
}

function confirmChangeProjectPopup() {
    const state = PopupState.changeProject;
    const project = PopupState.projects.data.find(p => p.id === state.selectedProjectId);
    
    if (project) {
        confirmChangeProject(state.chatId, project.id, project.name);
    }
}

function confirmChangeProject(chatId, projectId, projectName) {
    closeGeneralModal();
    // 실제 데이터 업데이트
    const chat = chatData.find(c => c.id === parseInt(chatId));
    if (chat) {
        chat.projectId = projectId;
        chat.projectName = projectName;
    }
    showToast(`"${projectName}" 프로젝트로 변경되었습니다`, 'success');
    renderChatHistory();
}

function removeChatFromProject() {
    const menu = document.getElementById('chatContextMenu');
    const chatId = parseInt(menu.dataset.chatId);
    closeChatContextMenu();
    
    // 커스텀 확인 모달 열기
    openConfirmModal(
        '프로젝트에서 제거',
        '프로젝트에서 이 대화를 제거하시겠습니까?<br><span style="color: var(--text-tertiary); font-size: 12px;">대화는 삭제되지 않고 "최근 대화" 목록으로 이동합니다.</span>',
        '제거',
        'warning',
        () => {
            const chat = chatData.find(c => c.id === chatId);
            if (chat) {
                chat.projectId = null;
                chat.projectName = null;
            }
            showToast('프로젝트에서 제거되었습니다', 'success');
            renderChatHistory();
        }
    );
}

function toggleChatSearch() {
    openSearchModal();
}

// ========== Search Modal ==========
function openSearchModal() {
    const modalContent = `
        <div class="popup-header">
            <div class="popup-header__icon popup-header__icon--purple">
                <svg class="icon" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
            </div>
            <div class="popup-header__text">
                <div class="popup-header__title">대화 검색</div>
                <div class="popup-header__subtitle">대화 내용에서 키워드를 검색합니다</div>
            </div>
            <button class="popup-close" onclick="closeGeneralModal()">
                <svg class="icon" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
        </div>
        <div style="padding: 16px 20px; border-bottom: 1px solid var(--border);">
            <div style="position: relative;">
                <svg class="icon icon--sm" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-tertiary);" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                <input type="text" id="chatSearchInput" placeholder="대화 내용 검색..." style="width: 100%; padding: 10px 12px 10px 40px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; font-family: var(--font-sans);" oninput="filterSearchResults(this.value)">
            </div>
        </div>
        <div id="searchResults" style="max-height: 300px; overflow-y: auto; padding: 12px;">
            <p style="color: var(--text-tertiary); font-size: 13px; text-align: center; padding: 20px;">검색어를 입력하세요</p>
        </div>
    `;
    
    document.getElementById('generalModalTitle').innerHTML = '';
    document.getElementById('generalModalBody').innerHTML = modalContent;
    document.getElementById('generalModalFooter').style.display = 'none';
    document.querySelector('#modalOverlay .modal').classList.add('modal--popup');
    document.getElementById('modalOverlay').classList.add('modal-overlay--open');
    
    setTimeout(() => document.getElementById('chatSearchInput')?.focus(), 100);
}

function filterSearchResults(query) {
    const results = document.getElementById('searchResults');
    if (!query.trim()) {
        results.innerHTML = '<p style="color: var(--text-tertiary); font-size: 13px; text-align: center; padding: 20px;">검색어를 입력하세요</p>';
        return;
    }
    
    // 대화 데이터에서 검색
    const searchTerm = query.toLowerCase();
    const matchedChats = chatData.filter(chat => 
        chat.title.toLowerCase().includes(searchTerm) ||
        (chat.projectName && chat.projectName.toLowerCase().includes(searchTerm))
    );
    
    if (matchedChats.length === 0) {
        results.innerHTML = `<p style="color: var(--text-tertiary); font-size: 13px; text-align: center; padding: 20px;">"${escapeHtml(query)}"에 대한 검색 결과가 없습니다</p>`;
        return;
    }
    
    let html = '<div style="display: grid; gap: 8px;">';
    matchedChats.forEach(chat => {
        const projectBadge = chat.projectName 
            ? `<span style="display: inline-flex; align-items: center; gap: 3px; font-size: 10px; font-weight: 500; padding: 1px 6px; border-radius: 4px; background: var(--primary-100); color: var(--primary-600);">
                <svg class="icon" style="width: 10px; height: 10px;" viewBox="0 0 24 24"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
                ${escapeHtml(chat.projectName)}
               </span>`
            : '';
        
        html += `
            <div style="padding: 12px; background: var(--surface); border-radius: 8px; cursor: pointer; transition: all 0.2s;" 
                 onclick="loadChatFromSearch(${chat.id})"
                 onmouseover="this.style.background='var(--primary-50)'" 
                 onmouseout="this.style.background='var(--surface)'">
                <div style="font-weight: 500; margin-bottom: 4px; color: var(--text-primary);">${escapeHtml(chat.title)}</div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 12px; color: var(--text-tertiary);">${chat.time}</span>
                    ${projectBadge}
                </div>
            </div>
        `;
    });
    html += '</div>';
    
    results.innerHTML = html;
}

function loadChatFromSearch(chatId) {
    closeGeneralModal();
    // 실제 구현에서는 해당 채팅으로 이동
    showToast('대화를 불러옵니다...', 'info');
}

// ========== State ==========
let currentTab = 'template';
let currentTemplate = null;
let selectedColor = 'purple';

// ========== Template Data ==========
const templates = {
    tutor: {
        color: 'blue',
        initial: '코',
        type: 'platform',
        name: '코딩 튜터',
        desc: 'Python, JavaScript 등 프로그래밍 언어를 친절하게 가르치는 튜터 에이전트입니다.',
        prompt: `[역할 (Role)]
당신은 10년 경력의 시니어 개발자이자 프로그래밍 교육 전문가입니다.
학생들에게 프로그래밍 개념을 명확하고 이해하기 쉽게 설명하는 것이 당신의 역할입니다.

[전문성 (Expertise)]
- Python, JavaScript, Java 등 주요 프로그래밍 언어
- 알고리즘과 자료구조
- 코드 디버깅 및 최적화
- 베스트 프랙티스 및 설계 패턴

[톤 & 스타일 (Tone)]
- 친근하고 격려하는 톤
- 복잡한 개념을 단순하게 설명
- 비유와 예시를 적극 활용
- 학생의 이해도를 확인하며 진행

[제약 조건 (Constraints)]
- 코드 예제는 항상 주석과 함께 제공
- 단계별로 설명하여 이해를 돕기
- 학생이 스스로 생각할 수 있도록 힌트 제공
- 오류가 있을 때는 직접 답을 주기보다 디버깅 방법 안내`
    },
    writer: {
        color: 'pink',
        initial: '콘',
        type: 'platform',
        name: '콘텐츠 작가',
        desc: '블로그, 마케팅 문구 등 다양한 콘텐츠를 작성하는 전문 작가 에이전트입니다.',
        prompt: `[역할 (Role)]
당신은 10년 경력의 전문 카피라이터이자 콘텐츠 마케터입니다.
다양한 형식의 매력적인 콘텐츠를 작성하는 것이 당신의 역할입니다.

[전문성 (Expertise)]
- 블로그 포스트 및 아티클 작성
- SNS 콘텐츠 및 광고 카피
- 이메일 마케팅 문구
- SEO 최적화 콘텐츠

[톤 & 스타일 (Tone)]
- 독자의 관심을 끄는 후킹 문구 사용
- 브랜드 톤에 맞는 일관된 스타일
- 간결하면서도 설득력 있는 문체
- 타겟 독자층에 맞춤화된 언어

[제약 조건 (Constraints)]
- 과장된 표현이나 허위 정보 금지
- 저작권 침해 콘텐츠 생성 금지
- 요청된 형식과 길이 준수
- 명확한 CTA(Call to Action) 포함`
    },
    translator: {
        color: 'green',
        initial: '전',
        type: 'platform',
        name: '전문 번역가',
        desc: '영어, 일본어, 중국어 등 다국어 번역을 전문으로 하는 번역가 에이전트입니다.',
        prompt: `[역할 (Role)]
당신은 다국어 전문 번역가입니다.
원문의 의미와 뉘앙스를 정확하게 전달하면서 자연스러운 번역을 제공합니다.

[전문성 (Expertise)]
- 영어 ↔ 한국어 번역
- 일본어 ↔ 한국어 번역
- 중국어 ↔ 한국어 번역
- 비즈니스, 기술, 마케팅 문서 전문

[톤 & 스타일 (Tone)]
- 원문의 톤과 스타일 유지
- 문화적 맥락을 고려한 자연스러운 표현
- 전문 용어의 정확한 번역
- 가독성 높은 문장 구조

[제약 조건 (Constraints)]
- 원문의 의미 왜곡 금지
- 불확실한 번역은 대안 제시
- 고유명사는 원어 병기
- 문화적으로 부적절한 표현 수정 제안`
    },
    marketing: {
        color: 'orange',
        initial: '마',
        type: 'instructor',
        name: '마케팅 분석가',
        desc: '마케팅 데이터를 분석하고 캠페인 전략을 제안하는 분석 전문 에이전트입니다.',
        prompt: `[역할 (Role)]
당신은 10년 경력의 마케팅 데이터 분석 전문가입니다.
다양한 마케팅 지표를 분석하고 인사이트를 도출하여 효과적인 전략을 제안합니다.

[전문성 (Expertise)]
- 디지털 마케팅 성과 분석 (CTR, CVR, ROAS 등)
- 고객 세그먼트 분석 및 타겟팅
- A/B 테스트 설계 및 결과 해석
- 경쟁사 분석 및 시장 트렌드 파악

[톤 & 스타일 (Tone)]
- 데이터 기반의 객관적인 분석
- 비즈니스 임팩트 중심의 인사이트 제공
- 실행 가능한 구체적 제안
- 전문 용어는 쉽게 설명

[제약 조건 (Constraints)]
- 근거 없는 추측 금지
- 데이터 출처 명시
- 한계점과 리스크 함께 언급
- 윤리적 마케팅 원칙 준수`
    },
    customer: {
        color: 'indigo',
        initial: '고',
        type: 'instructor',
        name: '고객 응대 봇',
        desc: '친절하고 전문적으로 고객 문의에 응대하는 CS 전문 에이전트입니다.',
        prompt: `[역할 (Role)]
당신은 친절하고 전문적인 고객 서비스 담당자입니다.
고객의 문의사항을 정확히 파악하고 신속하게 해결책을 제공합니다.

[전문성 (Expertise)]
- 제품/서비스 관련 문의 응대
- 불만 및 클레임 처리
- 주문/배송/환불 안내
- FAQ 기반 정보 제공

[톤 & 스타일 (Tone)]
- 항상 정중하고 친절한 어조
- 공감을 표현하며 경청
- 명확하고 이해하기 쉬운 설명
- 긍정적인 표현 사용

[제약 조건 (Constraints)]
- 고객 정보 보호 철저
- 확인되지 않은 정보 제공 금지
- 감정적 대응 금지
- 해결 불가 시 담당자 연결 안내`
    }
};

// ========== Tab Functions ==========
function switchTab(tab) {
    currentTab = tab;
    
    // Update tab buttons
    document.getElementById('tabTemplate').classList.toggle('agent-tab--active', tab === 'template');
    document.getElementById('tabMy').classList.toggle('agent-tab--active', tab === 'my');
    
    // Update grids
    document.getElementById('templateGrid').style.display = tab === 'template' ? 'grid' : 'none';
    document.getElementById('myAgentGrid').style.display = tab === 'my' ? 'grid' : 'none';
    
    // Update stats bar visibility
    document.getElementById('statsBar').style.display = tab === 'my' ? 'flex' : 'none';
    
    // Update new agent button visibility
    document.getElementById('newAgentBtn').style.display = tab === 'my' ? 'inline-flex' : 'none';
    
    // Update pagination visibility
    document.getElementById('pagination').style.display = tab === 'my' ? 'flex' : 'none';
    
    // Update toolbar filters visibility (상태 필터는 내 에이전트에서만)
    document.getElementById('statusFilter').style.display = tab === 'my' ? 'block' : 'none';
}

// ========== Template Functions ==========
function viewTemplate(templateId) {
    currentTemplate = templateId;
    const template = templates[templateId];
    
    // 상세 카드에 색상 클래스 적용
    const detailCard = document.getElementById('detailCard');
    detailCard.className = `detail-card detail-card--${template.color}`;
    
    // 템플릿 타입에 따라 배지 변경
    const badgeClass = template.type === 'instructor' ? 'agent-card__badge--instructor' : 'agent-card__badge--template';
    const badgeText = template.type === 'instructor' ? '강사' : '템플릿';
    
    document.getElementById('detailTitle').innerHTML = `${template.name} <span class="agent-card__badge ${badgeClass}">${badgeText}</span>`;
    document.getElementById('detailDesc').textContent = template.desc;
    document.getElementById('detailPrompt').textContent = template.prompt;
    
    document.getElementById('mainView').style.display = 'none';
    document.getElementById('templateDetail').classList.add('template-detail--active');
}

function backToList() {
    document.getElementById('mainView').style.display = 'block';
    document.getElementById('templateDetail').classList.remove('template-detail--active');
    currentTemplate = null;
}

function copyTemplate(templateId) {
    const template = templates[templateId];
    
    document.getElementById('modalTitle').textContent = '템플릿으로 에이전트 만들기';
    document.getElementById('agentName').value = template.name + ' (복사본)';
    document.getElementById('agentDesc').value = template.desc;
    document.getElementById('agentPrompt').value = template.prompt;
    
    // 색상 선택
    selectColor(template.color);
    
    openModal();
    showToast('템플릿을 불러왔습니다. 수정 후 저장하세요!', 'success');
}

// ========== Color Picker ==========
function selectColor(color) {
    selectedColor = color;
    document.querySelectorAll('.color-picker__item').forEach(item => {
        item.classList.toggle('color-picker__item--active', item.dataset.color === color);
    });
}

// Initialize color picker
document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.color-picker__item').forEach(item => {
        item.addEventListener('click', () => selectColor(item.dataset.color));
    });
});

// ========== Modal Functions ==========
function openCreateModal() {
    document.getElementById('modalTitle').textContent = '새 에이전트 만들기';
    document.getElementById('agentName').value = '';
    document.getElementById('agentDesc').value = '';
    document.getElementById('agentPrompt').value = '';
    selectColor('purple'); // 기본 색상
    openModal();
}

function openModal() {
    document.getElementById('agentModal').classList.add('modal-overlay--open');
}

function closeModal() {
    document.getElementById('agentModal').classList.remove('modal-overlay--open');
}

function saveAgent() {
    const name = document.getElementById('agentName').value.trim();
    const prompt = document.getElementById('agentPrompt').value.trim();
    
    if (!name) {
        showToast('에이전트 이름을 입력하세요', 'error');
        return;
    }
    if (!prompt) {
        showToast('시스템 프롬프트를 입력하세요', 'error');
        return;
    }
    
    closeModal();
    showToast('에이전트가 저장되었습니다!', 'success');
    
    // Switch to My Agents tab
    switchTab('my');
}

// ========== Agent Actions ==========
function editAgent(agentId) {
    document.getElementById('modalTitle').textContent = '에이전트 수정';
    // Load existing agent data...
    openModal();
}

function toggleAgentStatus(agentId, isActive) {
    const card = event.target.closest('.agent-card');
    const badge = card.querySelector('.agent-card__badge');
    
    if (isActive) {
        card.classList.remove('agent-card--inactive');
        badge.textContent = '활성';
        badge.className = 'agent-card__badge agent-card__badge--active';
        showToast('에이전트가 활성화되었습니다. AI 실습에서 불러올 수 있습니다.', 'success');
    } else {
        card.classList.add('agent-card--inactive');
        badge.textContent = '비활성';
        badge.className = 'agent-card__badge agent-card__badge--inactive';
        showToast('에이전트가 비활성화되었습니다.', 'info');
    }
}

function deleteAgent(agentId) {
    if (confirm('이 에이전트를 삭제하시겠습니까?')) {
        showToast('에이전트가 삭제되었습니다.', 'success');
        // Remove card from DOM or refresh
    }
}

// ========== Search ==========
function filterAgents(searchTerm) {
    const term = searchTerm.toLowerCase();
    const cards = document.querySelectorAll('.agent-card');
    
    cards.forEach(card => {
        const name = card.querySelector('.agent-card__name').textContent.toLowerCase();
        const desc = card.querySelector('.agent-card__desc').textContent.toLowerCase();
        const isMatch = name.includes(term) || desc.includes(term);
        card.style.display = isMatch ? '' : 'none';
    });
}

// ========== Filter Dropdowns ==========
function toggleDropdown(type) {
    const menu = document.getElementById(type + 'Menu');
    const btn = menu.previousElementSibling;
    const isOpen = menu.classList.contains('show');
    
    // Close all dropdowns first
    document.querySelectorAll('.filter-dropdown__menu').forEach(m => m.classList.remove('show'));
    document.querySelectorAll('.filter-dropdown__btn').forEach(b => b.classList.remove('active'));
    
    if (!isOpen) {
        menu.classList.add('show');
        btn.classList.add('active');
    }
}

function selectFilter(type, value, label) {
    document.getElementById(type + 'Label').textContent = label;
    
    // Update selected state
    const menu = document.getElementById(type + 'Menu');
    menu.querySelectorAll('.filter-dropdown__item').forEach(item => {
        item.classList.remove('selected');
    });
    event.target.closest('.filter-dropdown__item').classList.add('selected');
    
    // Close dropdown
    menu.classList.remove('show');
    menu.previousElementSibling.classList.remove('active');
    
    // Apply filter logic
    applyFilters();
}

function applyFilters() {
    // Filter and sort logic would go here
    console.log('Filters applied');
}

// Close dropdowns when clicking outside
document.addEventListener('click', (e) => {
    if (!e.target.closest('.filter-dropdown')) {
        document.querySelectorAll('.filter-dropdown__menu').forEach(m => m.classList.remove('show'));
        document.querySelectorAll('.filter-dropdown__btn').forEach(b => b.classList.remove('active'));
    }
    // 채팅 컨텍스트 메뉴 외부 클릭 감지
    if (!e.target.closest('.chat-item__menu') && !e.target.closest('#chatContextMenu')) {
        closeChatContextMenu();
    }
    // 클래스 드롭다운 외부 클릭 감지
    if (!e.target.closest('.class-selector')) {
        const btn = document.getElementById('classButton');
        const dropdown = document.getElementById('classDropdown');
        if (btn && dropdown) {
            btn.classList.remove('open');
            dropdown.classList.remove('class-dropdown--open');
        }
    }
});

// ========== Class Selector ==========
function toggleClassDropdown() {
    const btn = document.getElementById('classButton');
    const dropdown = document.getElementById('classDropdown');
    const isOpen = dropdown.classList.contains('class-dropdown--open');
    
    if (isOpen) {
        btn.classList.remove('open');
        dropdown.classList.remove('class-dropdown--open');
    } else {
        btn.classList.add('open');
        dropdown.classList.add('class-dropdown--open');
    }
}

function selectClass(classId, className, status, dday) {
    // 사이드바 클래스 선택기 업데이트
    document.getElementById('selectedClassName').textContent = className;
    document.getElementById('selectedClassDday').textContent = dday > 0 ? `D-${dday}` : '종료';
    
    // 상태 표시 업데이트
    const statusEl = document.getElementById('selectedClassStatus');
    const statusTextEl = document.getElementById('selectedClassStatusText');
    if (status === 'ended') {
        statusEl.classList.remove('class-selector__status--active');
        statusEl.classList.add('class-selector__status--ended');
        statusTextEl.textContent = '종료됨';
    } else {
        statusEl.classList.remove('class-selector__status--ended');
        statusEl.classList.add('class-selector__status--active');
        statusTextEl.textContent = '진행 중';
    }
    
    // 드롭다운 아이템 선택 상태 업데이트
    document.querySelectorAll('.class-dropdown__item').forEach(item => {
        item.classList.remove('class-dropdown__item--active');
        if (item.dataset.classId === classId) {
            item.classList.add('class-dropdown__item--active');
        }
    });
    
    // 드롭다운 닫기
    toggleClassDropdown();
    
    showToast(`"${className}" 클래스로 전환되었습니다`, 'success');
}

// ========== Initialization ==========
document.addEventListener('DOMContentLoaded', () => {
    renderChatHistory();
});

// ========== Toast ==========
function showToast(message, type = 'info') {
    const existing = document.querySelector('.toast');
    if (existing) existing.remove();
    
    const toast = document.createElement('div');
    toast.className = `toast${type !== 'info' ? ' toast--' + type : ''}`;
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
    }, 2500);
}

// ========== Event Listeners ==========
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        closeChatContextMenu();
        closeModal();
        closeGeneralModal();
        if (currentTemplate) backToList();
    }
});

// Close modal on overlay click
document.getElementById('agentModal').addEventListener('click', (e) => {
    if (e.target === document.getElementById('agentModal')) {
        closeModal();
    }
});
    </script>
</body>
</html>
